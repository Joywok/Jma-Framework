Jma.module("Components",function(t,e,i,a,s,n){t.Dicts={},t.Dicts.emojis=["smile","iphone","girl","smiley","heart","kiss","copyright","coffee","a","ab","airplane","alien","ambulance","angel","anger","angry","arrow_forward","arrow_left","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","art","astonished","atm","b","baby","baby_chick","baby_symbol","balloon","bamboo","bank","barber","baseball","basketball","bath","bear","beer","beers","beginner","bell","bento","bike","bikini","bird","birthday","black_square","blue_car","blue_heart","blush","boar","boat","bomb","book","boot","bouquet","bow","bowtie","boy","bread","briefcase","broken_heart","bug","bulb","person_with_blond_hair","phone","pig","pill","pisces","plus1","point_down","point_left","point_right","point_up","point_up_2","police_car","poop","post_office","postbox","pray","princess","punch","purple_heart","question","rabbit","racehorse","radio","up","us","v","vhs","vibration_mode","virgo","vs","walking","warning","watermelon","wave","wc","wedding","whale","wheelchair","white_square","wind_chime","wink","wink2","wolf","woman","womans_hat","womens","x","yellow_heart","zap","zzz","+1","-1"],t.Form=t.Form||{},t.Form.editors=t.Form.editors||{},i.Form.Field=i.Form.Field.extend({templateData:function(){var t=this.schema;return{help:t.help||"",title:t.title,description:t.description?'<span class="form-tips">'+t.description+"</span>":"",titleHTML:t.titleHTML,fieldAttrs:t.fieldAttrs,editorAttrs:t.editorAttrs,key:this.key,editorId:this.editor.id}}}),t.Form=i.Form.extend({events:{submit:"onSubmit","click .cancel-btn":"onCancel"},template:n.template('	    <form class="form-horizontal" role="form">	      <div data-fieldsets></div>	      <div class="form-group form-bar"><div class="col-md-12">	        <button class="btn btn-success" type="submit">提交</button>	        <button class="btn btn-default cancel-btn" type="button">取消</button>	      </div></div>	    </form>	  '),initialize:function(t){i.Form.prototype.initialize.apply(this,arguments),this.options=n.extend({submitButton:"提交"},t),this.errors={},this.complete=!0,this.submitButton=null,e.Components.Form.validators.required=function(t){return t=n.extend({type:"required",message:e.Components.Form.validators.errMessages.required},t),function(e){t.value=e;var i={type:t.type,message:n.isFunction(t.message)?t.message(t):t.message};return"-0"===e||null===e||void 0===e||e===!1||""===e||n.isArray(e)&&0===e.length?i:void 0}},this.on("field:change field:blur",this.validateField,this),this.on("validate",this.setButtonState,this),this.model&&this.model.on("request",this.onRequest,this),this.model&&this.model.unbind("change")&&this.model.on("change",this.onModelChange,this),this.model&&!this.model.isNew()&&this.options.patch&&(this.old_model=this.model.clone())},handleEditorEvent:function(t,e){i.Form.prototype.handleEditorEvent.apply(this,arguments),this.trigger("field:"+t,e.key)},validate:function(){var t=i.Form.prototype.validate.apply(this,arguments);return this.errors=null==t?{}:t,this.trigger("validate",this.errors),t},validateField:function(t){if(this.submitButton){var e=this.fields[t].validate();return e?this.errors[t]=e:delete this.errors[t],this.trigger("validate",this.errors),this.errors}},validateEditors:function(){for(var t in this.fields){var e=this.fields[t].editor.validate();e&&(this.errors[t]=e)}return this.trigger("validate",this.errors),this.errors},setButtonState:function(){n.isEmpty(this.errors)&&this.complete?this.submitButton.removeClass("disabled").removeAttr("disabled").html(this.options.submitButton):this.submitButton.addClass("disabled").attr("disabled","disabled")&&this.options.processing&&this.submitButton.html('<i class="fa fa-refresh fa-spin"></i> '+this.options.processing)},render:function(){return i.Form.prototype.render.apply(this,arguments),this.trigger("render"),this.values=this.getValue(),this.submitButton=this.$el.find(":submit"),this.validateEditors(),this},onShow:function(){this.$el.find(".form-tips").children().addClass("text-muted").tooltip({container:"body"})},resetValue:function(){this.setValue(this.values)},templateData:function(){var t={submitButton:this.options.submitButton};return t},onSubmit:function(t){var e=this;if(t.preventDefault(),!this.commit()){var i,a={success:function(t,i){e.trigger("success",{model:t,response:i})},error:function(t,i){e.trigger("error",{model:t,response:i})}};if(!("placeholder"in document.createElement("input"))){var s=this.model.schema?this.model.schema:this.options.schema;n.each(s,function(t,i){t.editorAttrs&&t.editorAttrs.placeholder&&e.model.get(i)==t.editorAttrs.placeholder&&e.model.set(i,"")})}if(!this.model.isNew()&&this.options.patch){this.options.patch&&(a.patch=!0);var o=this.old_model.changedAttributes(this.model.toJSON());if(!(n.size(o)>0))return this.complete=!0,this.setButtonState(),void 0;i=this.model.save(o,a)}else i=this.model.save(this.model.toJSON(),a);i.always(function(){e.complete=!0,e.setButtonState()})}},onModelChange:function(){var t=this.model.toJSON();this.setValue(t),this.validateEditors(),this.setButtonState()},onRequest:function(){var t=this;t.complete=!1,this.setButtonState()},onCancel:function(){this.trigger("form:cancel")}}),t.Form.editors.DatePicker=t.Form.editors.Text.extend({defaultValue:"",previousValue:"",defaults:{format:"yyyy-mm-dd",autoclose:!0,language:"zh-CN",todayBtn:!1},events:{keyup:"determineChange",keypress:function(){var t=this;setTimeout(function(){t.determineChange()},0)},select:function(){this.trigger("select",this)},focus:function(){},blur:function(){}},initialize:function(e){var i=this;t.Form.editors.Text.prototype.initialize.call(this,e),this.value=this.defaultValue,this.defaultValue=this.value,this.$el.addClass("datepicker-input"),this.$el.datepicker(n.extend(n.clone(this.defaults),this.schema.options)).on("changeDate",function(t){i.value=parseInt(t.date.getTime()/1e3),i.checkChange()}).on("clearDate",function(){i.setValue("-0")}),this.DatePicker=this.$el.data("datepicker"),this.setValue(this.value)},determineChange:function(){},getValue:function(){return this.value},setValue:function(t){if(this.value=""==t?"-0":t,"-0"==this.value)return this.value;var e=new Date(1e3*t);this.DatePicker.setDate(e)},checkChange:function(e){t.Form.editors.Text.prototype.determineChange.call(this,e)}}),t.Form.editors.NotNullDatePicker=t.Form.editors.Text.extend({defaultValue:"",defaults:{format:"yyyy-mm-dd",autoclose:!0,language:"zh-CN",todayBtn:!1},initialize:function(e){var i=this;t.Form.editors.Text.prototype.initialize.call(this,e),this.defaultValue=this.value,this.$el.addClass("datepicker-input"),this.options=n.defaults(e,this.defaults),this.$el.datepicker(this.options).on("hide",function(t){"undefined"==typeof t.date?i.setValue(parseInt((new Date).getTime()/1e3)):(i.value=parseInt(t.date.getTime()/1e3),i.form&&i.form.trigger(i.options.key+":change",i.form,i)||i.trigger("change",i))}).on("changeDate",function(t){"undefined"==typeof t.date?i.setValue(parseInt((new Date).getTime()/1e3)):(i.value=parseInt(t.date.getTime()/1e3),i.form&&i.form.trigger(i.options.key+":change",i.form,i)||i.trigger("change",i))}),this.DatePicker=this.$el.data("datepicker"),this.setValue(this.value)},determineChange:function(){},getValue:function(){return this.value},setValue:function(t){this.value=t;var e=new Date(1e3*t);this.DatePicker.setDate(e)}}),t.Form.editors.TagsInput=t.Form.editors.Text.extend({defaults:{freeInput:!0,itemValue:"id",itemText:"name"},Collection:i.Collection,initialize:function(e){var i=this;if(this.$el.on("change",function(){i.trigger("change",i),s(i.$el).parents(".form-group").hasClass("has-error")?s(i.$el).parents(".form-group").find(".bootstrap-tagsinput").css({border:"1px red solid"}):s(i.$el).parents(".form-group").find(".bootstrap-tagsinput").css({border:"1px solid #ccc"})}),t.Form.editors.Text.prototype.initialize.call(this,e),this.defaults.items)var a=this.defaults.items;else var a=8;this.collection=e.schema.collection||this.collection||new this.Collection,this.options={},e.schema.options&&(this.options=e.schema.options),this.options=n.extend(this.options,this.defaults,{typeahead:{source:function(t){var e=s.Deferred();return i.collection.on("reset",function(){e.resolve(this.toJSON())}),i.collection.fetch({data:{s:t},reset:!0}),e},matcher:function(t){return t},items:a},tagClass:this.tagClass},e.schema.tagsinput),this.form.on("render",this.onRender,this)},tagClass:function(){return"label label-info"},getValue:function(){return this.$el.tagsinput("items")},setValue:function(t){var e=this;n.isArray(t)&&n.each(t,function(t){e.$el.tagsinput("add",t)})},render:function(){return this},onRender:function(){var t=this;this.$el.tagsinput(this.options),this.setValue(this.value),s(this.$el).parent().delegate(".bootstrap-tagsinput input","blur",function(){t.$el.blur(),s(t.$el).parents(".form-group").hasClass("has-error")?s(this).parents(".bootstrap-tagsinput").css({border:"1px red solid"}):s(this).parents(".bootstrap-tagsinput").css({border:"1px solid #ccc"})})},remove:function(){this.$el.datepicker("remove"),t.Form.editors.Text.prototype.remove.apply(this,arguments)},addItem:function(t){this.$el.tagsinput("add",t)}}),t.Form.editors.BaseUploader=t.Form.editors.Base.extend({defaults:{multiple:!0,params:{app_type:"Ehrs_app_spms",app_id:"project_tmp_id"},url:"/devp/uploader/upload.php"},initialize:function(e){if(n.bindAll(this,"fileAdd","fileRemove","fileInvalid","tooManyFile","beforeUpload","uploadStart","uploadAbort","uploadComplete","uploadError","uploadProgress","render","_showAttaches","initUploader"),t.Form.editors.Base.prototype.initialize.apply(this,arguments),n.extend(this,this.defaults,n.pick(e.schema,"url","title","params","multiple","collectionName","viewsName","button","dropZone")),!this.button)throw new Error("Upload button must be specified.");this.collectionName=this.collectionName||Juggler.Entities.Collection,this.viewsName=this.viewsName||Juggler.Views.AttachesView,this.collection=new this.collectionName(this.model.get(this.key)),this.collection.on("add remove reset",this._showAttaches),this.initUploader()},validate:function(){var t={type:"uploader",message:"文件正在上传，请稍后..."};return this.uploader&&this.uploader.countFiles("UPLOADING")?t:void 0},initUploader:function(){this.uploader=new Uploader({selectButton:this.button,url:this.url,data:this.params,acceptSize:[null,51200],dropZone:this.dropZone,errors:{invalidType:"The file '{{fileName}}' is not valid. Please upload only files with the following extensions: {{allowedExtensions}}.",sizeTooSmall:"The file '{{fileName}}' is too small. Please upload only files bigger than {{allowedMinSize}}.",sizeTooLarge:"文件：'{{fileName}}'太大了,请重新上传小于50MB的文件.",tooManyFiles:"Can not upload the file '{{fileName}}'', because you can upload only {{maxFiles}} file(s).",networkError:"There was a problem uploading the file '{{fileName}}'. Please try uploading that file again."},headers:{Accept:"application/json, text/javascript, */*; q=0.01"}}),this.uploader.on("fileAdd",this.fileAdd).on("fileRemove",this.fileRemove).on("fileInvalid",this.fileInvalid).on("tooManyFile",this.tooManyFile).on("beforeUpload",this.beforeUpload).on("uploadStart",this.uploadStart).on("uploadProgress",this.uploadProgress).on("uploadAbort",this.uploadAbort).on("uploadComplete",this.uploadComplete).on("uploadFail",this.uploadError)},destroy:function(){this.uploader.destroyAll()},_showAttaches:function(){0==this.collection.length?this.$el.hide():this.$el.show()},render:function(){return this._initAttachesView(),this.$el.html(this.attachesView.$el),this._showAttaches(),this},_initAttachesView:function(){this.attachesView||(this.attachesView=new this.viewsName({collection:this.collection}),this.attachesView.render(),this.attachesView.on("childview:removeAttach",function(t,e){e.model.destroy()}))},getValue:function(){return this.collection.toJSON()},setValue:function(t){if(!n(t).isArray())throw new Error("文件格式错误");this.collection.reset(t)},addUploaded:function(t){this.collection.add(t)},removeUploaded:function(t){this.setValue(n.reject(this.getValue(),function(e){return e.id==t}))},updateList:function(){},fileInvalid:function(){},tooManyFile:function(){},beforeUpload:function(){},uploadStart:function(){},uploadComplete:function(t,e,i,a){if(200==a){i=JSON.parse(i);var s=n.pick(i,"id","name","file_size","file_type","show_name","type");"Ehrs_n_image"==i.file_type&&(s.thumb=i.append.thumbnails.link),this.collection.get(t).clear({silent:!0}).set(s)}},uploadError:function(){},uploadProgress:function(t,e,i,a){this.collection.get(t)&&this.collection.get(t).set({loaded:i,total:a})},fileAdd:function(t,e,i){this.collection.add(n.extend({},i,{id:t,uploading:!0}))},fileRemove:function(){},uploadAbort:function(){}}),t.Form.editors.CheckboxTextArea=t.Form.editors.Text.extend({tagName:"textarea",events:{keydown:"getTextareaValue",keyup:"setTextareaValue"},getTextareaValue:function(){this.val=this.$el.val(),""!=this.val&&","!=this.val.split("")[this.val.length-1]&&(this.val=this.val+","),this.$el.val("")},setTextareaValue:function(){this.$el.val(this.val)},initialize:function(){},reder:function(){return this}}),t.Form.editors.Integer=t.Form.editors.Number.extend({onKeyPress:function(t){var e=this,i=function(){setTimeout(function(){e.determineChange()},0)};if(0===t.charCode)return i(),void 0;var a=this.$el.val();void 0!=t.charCode&&(a+=String.fromCharCode(t.charCode));var s=/^[0-9]*?$/.test(a);s?i():t.preventDefault()}}),t.Form.editors.BootstrapSelect=t.Form.editors.Select.extend({className:"btn-group split-dropdown-menu",tagName:"div",events:{change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)},"click li a":"select"},initialize:function(e){t.Form.editors.Select.prototype.initialize.call(this,e),this.template=e.template||this.constructor.template},render:function(){return this.schema=n.extend({},{style:"default"},this.schema),this.$el.append(this.template({action:this.schema.options[0],style:this.schema.style})),this.setOptions(this.schema.options),"undefined"==typeof this.schema.size&&(this.schema.size=1),this.schema.disabled&&this.$el.find("button").attr("disabled","true"),this.$el.attr("size",this.schema.size),this},select:function(t){t.preventDefault(),this.setValue(s(t.target).attr("value")),this.trigger("change",this)},getValue:function(){var t=this.schema.options,e=this.$(".btn-actionname").html(),a=this.$(".btn-actionname").data("value");if(n.isArray(t)){e||(e=t[0].label);var s=n.findWhere(t,{label:e});return s?s.val:""}return t instanceof i.Collection?a:n.findWhere(t,{label:e})},setValue:function(t){var e,a=this.schema.options;if(a instanceof i.Collection)a.length>0?(t=n.isUndefined(t)||n.isUndefined(a.get(t))?a.at(0).get("id"):t,e=a.get(t).get(this.getkeys().label)):e="";else if(n.isArray(a)||n.isObject(a))if(t||(t=a[0].val),"number"==typeof a[0].val&&(t=parseInt(t)),"object"==typeof t&&(t=t.id),""==t)e="";else{var s=n.findWhere(a,{val:t});e=s?s.label:""}else e=t;""==e&&(e="&nbsp;"),this.$(".btn-actionname").html(e),this.$(".btn-actionname").data("value",t)},getkeys:function(){return"undefined"==typeof this.schema.labelval?{val:"val",label:"label"}:this.schema.labelval},renderOptions:function(t){var e,a=this.$el.find(".dropdown-menu");if(t instanceof i.Collection){t=t.toJSON();var s=this.schema.labelval;if(t[0]){if("undefined"==typeof s)var o={val:"val",label:"label"};else var o=s;t=n.map(t,function(t){return{val:t[o.val],label:t[o.label]}})}else t=[{val:"",label:"请选择"}]}e=this._getOptionsHtml(t),a.html(e),this.setValue(this.value)},_arrayToHtml:function(t){var e=[];return n.each(t,function(t){if(n.isObject(t))if(t.group)e.push('<optgroup label="'+t.group+'">'),e.push(this._getOptionsHtml(t.options)),e.push("</optgroup>");else{var i=t.val||0===t.val?t.val:"",a=t.level||2==t.level?"&nbsp;&nbsp;&nbsp;&nbsp;"+t.label:t.label;e.push('<li title="'+a+'"><a class="ellipsis" href="#" value="'+i+'">'+a+"</a></li>")}else e.push('<li title="'+t+'"><a class="ellipsis" href="#" value="'+t+'">'+t+"</a></li>")},this),e.join("")}},{template:n.template('	  <button type="button" class="btn btn-<%= style %> btn-actionname ellipsis yjl-btn yjl-title"><%= action %></button>	  <button type="button" class="btn btn-<%= style %> dropdown-toggle yjl-title-btn" data-toggle="dropdown" aria-expanded="false">	  <span class="caret"></span>	  <span class="sr-only">Toggle Dropdown</span>	  </button>	  <ul class="dropdown-menu" role="menu"></ul>	',null,t.Form.templateSettings)}),t.Form.editors.setSelect=t.Form.editors.Select.extend({render:function(){return this.setOptions(this.schema.options),this},renderOptions:function(t){var e=this.schema.labelval;if(t instanceof i.Collection&&(t=t.toJSON()),t[0]){if("undefined"==typeof e)var a={val:"val",label:"label"};else var a=e;t=n.map(t,function(t){return{val:t[a.val],label:t[a.label]}})}else t=[{val:0,label:"请选择"}];var s,o=this.$el;s=this._getOptionsHtml(t),o.html(s),this.value?this.setValue(this.value):this.setValue(t[0].val)}}),t.Form.editors.BootstrapCheckboxes=t.Form.editors.Checkboxes.extend({className:"BootstrapCheckboxes",_arrayToHtml:function(t){var e=s(),i=this;return this._array=t,n.each(t,function(t,a){var o=s("<li>");if(i.schema.liClass&&o.addClass(i.schema.liClass),n.isObject(t))if(t.group){var r=i.id;i.id+="-"+i.groupNumber++,o=s('<fieldset class="group">').append(s("<legend>").text(t.group)),o=o.append(i._arrayToHtml(t.options)),i.id=r,close=!1}else{var l=t.val||0===t.val?t.val:"";t.labelHTML?o.append(s('<label for="'+i.id+"-"+a+'">').html(t.labelHTML)):o.append(s('<label for="'+i.id+"-"+a+'">').text(t.label)),o.find("label").prepend(s('<input type="checkbox" name="'+i.getName()+'" id="'+i.id+"-"+a+'" />').val(l))}else o.append(s('<label for="'+i.id+"-"+a+'">').text(t)),o.find("label").prepend(s('<input type="checkbox" name="'+i.getName()+'" id="'+i.id+"-"+a+'" />').val(t));e=e.add(o)}),0==t.length&&this.schema.nullTip&&(e=s('<li><span class="nullTip">'+this.schema.nullTip+"</span></li>")),e}}),t.Form.editors.BBC=t.Form.editors.Base.extend({initialize:function(e){if(t.Form.editors.Base.prototype.initialize.apply(this,arguments),n.extend(this,this.defaults,e.schema),null==this.viewConstructor)throw new Error("Missing viewConstructor");if(null==this.collection){if(null==this.collectionConstructor)throw new Error("Missing collection & collectionConstructor");this.collection=new this.collectionConstructor(this.model.get(this.key))}this.collection.on("add remove",this._showCollection),this.collection.toJSON=function(){return this.reset(this.where({checked:!0})),i.Collection.prototype.toJSON.apply(this,arguments)},this.collection.fetch({reset:!0})},render:function(){return this._initCollectionView(),this.$el.html(this.collectionView.$el),this._showCollection(),this},getValue:function(){return this.collection.toJSON()},setValue:function(t){if(!n(t).isArray())throw new Error("Format Error");this.collection.reset(t)},dialogReady:function(){this._showCollection()},className:"",_showCollection:function(){0==this.collection.length?this.$el.hide():this.$el.show()},_initCollectionView:function(){this.collectionView||(this.collectionView=new this.viewConstructor({collection:this.collection})),this.collectionView.render()}}),t.Form.editors.FilesUpload=t.Form.editors.BaseUploader.extend({initialize:function(){t.Form.editors.BaseUploader.prototype.initialize.apply(this,arguments),this._additionalInitialzer()},_additionalInitialzer:function(){n.extend(this.collection,{pid:this.params.pid,achievement_id:this.params.achievement_id}),(n.isUndefined(this.schema.loadDocs)||this.schema.loadDocs)&&this.collection.fetch({reset:!0})},render:function(){return s(this.dropZone).length>0&&t.Form.editors.BaseUploader.prototype.render.apply(this,arguments),this},dropZoneDragOver:"dropZoneDragOver",dropZoneReady:function(){var t=this;s(this.dropZone).on("dragover.Uploader",function(e){e.preventDefault(),s(this).addClass(t.dropZoneDragOver)}).on("dragend.Uploader",function(e){e.preventDefault(),t.collection.length>0&&s(this).removeClass(t.dropZoneDragOver)}).on("dragleave.Uploader",function(e){e.preventDefault(),t.collection.length>0&&s(this).removeClass(t.dropZoneDragOver)}).on("drop.Uploader",function(e){e.preventDefault(),t.uploader.constructor.support.dropFiles?(s(this).removeClass(t.dropZoneDragOver),e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files&&t.uploader.addToList(e.originalEvent.dataTransfer.files)):(t.collection.length>0&&s(this).removeClass(t.dropZoneDragOver),Spms.vent.trigger("message","当前浏览器不支持文件拖拽方式上传"))}),this.render()},_initAttachesView:function(){this.attachesView||(this.attachesView=new this.viewsName({collection:this.collection}),this.attachesView.render(),this.attachesView.on("childview:removeAttach",this.removeChildAttach),this.attachesView.on("childview:hide",this._showAttaches))},removeChildAttach:function(t,e){var i=this,a=e.model;a.isNew()?i.collection.remove(a):(a.set("del_flg","1"),t.trigger("hide").$el.hide())},_showAttaches:function(){0==this.collection.where({del_flg:"0"}).length?s(this.dropZone).addClass(this.dropZoneDragOver):s(this.dropZone).removeClass(this.dropZoneDragOver)},fileAdd:function(t,e,i){var a=n.extend({uploading:!0,uniqueId:t,upload_time:Date.now()/1e3,uploader:SPMS_GV.user,del_flg:"0",name:i.name||e,size:i.size||null},n.pick(this.params,"app_type","app_id","achievement_id","pid"),{belong_unit:SPMS_GV.user.dept_ids});this.collection.add(a),this.resetButtonState(!1)},fileInvalid:function(t,e){for(var i in e.errors)Spms.vent.trigger("message",e.errors[i].message);this.resetButtonState()},className:"",uploadError:function(t){var e=this.collection.findWhere({uniqueId:t});Spms.vent.trigger("message","网络传输异常，请联系管理员！"),this.collection.remove(e),this.resetButtonState()},uploadComplete:function(t,e,i,a){var s=this.collection.findWhere({uniqueId:t});return i=JSON.parse(i),null!=a&&200!=a?(Spms.vent.trigger("message","系统异常，请联系管理员！"),this.resetButtonState(),void 0):n.isUndefined(i.error)?(s.unset("uploading",{silent:!0}).set({id:i.id,ext_name:i.ext_name,size:i.file_size}),this.resetButtonState(),void 0):(Spms.vent.trigger("message",i.error+":"+e),this.collection.remove(s),this.resetButtonState(),void 0)},setValue:function(){},resetButtonState:function(t){this.form.complete=n.isUndefined(t)?this.collection.where({uploading:!0}).length>0?!1:!0:t,this.form.setButtonState()}}),t.Form.editors.TaskFilesUpload=t.Form.editors.FilesUpload.extend({_additionalInitialzer:function(){n.extend(this.collection,{app_id:this.params.app_id,app_type:this.params.app_type,task_id:this.params.task_id,pid:this.params.pid}),(n.isUndefined(this.schema.loadDocs)||this.schema.loadDocs)&&this.collection.fetch({reset:!0})},fileAdd:function(t,e,i){var a=n.extend({uploading:!0,uniqueId:t,upload_time:Date.now()/1e3,uploader:SPMS_GV.user,del_flg:"0"},n.pick(this.params,"app_type","app_id","task_id","pid"),n.pick(i,"name","size"),{belong_unit:SPMS_GV.user.dept_ids});this.collection.add(a),this.form.complete=!1,this.form.setButtonState()}}),t.Form.editors.TextAreaHelper=t.Form.editors.TextArea.extend({defaults:{autoheight:!0},Collection:i.Collection.extend({url:"",parse:function(t){return t.data.data}}),initialize:function(t){this.options=n.extend({},this.defaults,t),this.constructor.__super__.initialize.call(this,t),this.collection=t.schema.collection||this.collection||new this.Collection,this._initAtWho(),this.options.autoheight&&this._initAutoHeight()},textChange:function(){},_initAtWho:function(){var e=s.map(t.Dicts.emojis,function(t){return{key:t,name:t}}),i=this,a={at:"@",callbacks:{remote_filter:function(t,e){i.collection.fetch({data:{s:t},reset:!0,success:function(t,i){e(i.data.data)}})},sorter:function(t,e){return e},tpl_eval:function(t,e){t="<li title=${name} data-value=${atwho-at}${name} data-id=${id} data-type=${type} data-name=${name}>${name}</li>";var i;try{return t.replace(/\$\{([^\}]*)\}/g,function(t,i){return e[i]})}catch(a){return i=a,""}},before_insert:function(t,e){return i.trigger("add_at_who",{id:e.attr("data-id"),name:e.attr("data-name"),type:e.attr("data-type")}),t}},limit:8,start_with_space:!1,startWithSpace:!1},n={at:":",data:e,tpl:"<li class='at' data-value='${atwho-at}${name}'><img src='http://assets.github.com/images/icons/emoji/${name}.png'  height='20' width='20' /></li>",insert_tpl:"<span id='${id}'>${atwho-data-value}</span>",limit:e.length};this._input_at=this.$el.atwho(a).atwho(n);var i=this;this._input_at.on("change",function(){})},_initAutoHeight:function(){this.$el.autosize()},getValue:function(){return s.trim(this.$el.val())},setValue:function(t){this.$el.val(s.trim(t))},determineChange:function(t){t&&this.options.schema.commitHelper&&13==t.keyCode&&t.ctrlKey&&this.trigger("checkSumit",t),this.trigger("change",this)}}),t.Form.editors.ShareObject=t.Form.editors.TagsInput.extend({Collection:i.Collection.extend({url:"/cmri/suggestion/share",parse:function(t){return t.data.data}}),initialize:function(e){n.extend(e);var a=e.schema.url?Ehr_HOSTS+e.schema.url:Ehr_HOSTS+"/cmri/suggestion/share";e.schema.items&&(this.defaults.items=e.schema.items),this.Collection=i.Collection.extend({url:a,parse:function(t){return t.data.data}}),t.Form.editors.TagsInput.prototype.initialize.call(this,e)},tagClass:function(t){var e="public"==t.id?"label label-success":"label label-primary";return t.locked&&(e+=" disabled"),e},onRender:function(){this.constructor.__super__.onRender.apply(this,arguments),this.$el.on("beforeItemRemove",function(t){t.item.locked&&(t.cancel=!0)})}}),t.Form.editors.ShareDepts=t.Form.editors.TagsInput.extend({defaults:{freeInput:!0,itemValue:"id",itemText:"name",items:100},Collection:e.Entities.ShareDepts,onRender:function(){var t=this;this.constructor.__super__.onRender.apply(this,arguments),this.$el.on("beforeItemRemove",function(t){t.item.locked&&(t.cancel=!0)}),s(this.$el).after('<button type="button" class="btn btn-default share-yjl-btn" aria-expanded="false">      <span class="caret"></span>      <span class="sr-only">Toggle Dropdown</span>      </button>'),s(this.$el).parent().find("button").on("click",function(){t.$el.tagsinput()[0].$input.val(" ").focus(),t.$el.tagsinput()[0].$input.trigger("keyup")})}}),t.Form.editors.ShareSpecail=t.Form.editors.TagsInput.extend({Collection:i.Collection.extend({url:"/spms/console/manager",parse:function(t){var e=[t.data.list[0].member,t.data.list[1].member];return e=n.flatten(e)}}),initialize:function(e){n.extend(e),e.schema.url&&(this.Collection.url=e.schema.url),t.Form.editors.TagsInput.prototype.initialize.call(this,e)},tagClass:function(t){var e="public"==t.id?"label label-success":"label label-primary";return t.locked&&(e+=" disabled"),e},onRender:function(){this.constructor.__super__.onRender.apply(this,arguments),this.$el.on("beforeItemRemove",function(t){t.item.locked&&(t.cancel=!0)})}}),t.Form.editors.DictCheckboxes=t.Form.editors.BootstrapCheckboxes.extend({_collectionToHtml:function(t){var e=[];t.each(function(t){e.push({val:t.id,label:t.get("name")})});var i=this._arrayToHtml(e);return i},getValue:function(){var t,e=this,i=[];return this.$("input[type=checkbox]:checked").each(function(){t=n.findWhere(e._array,{val:s(this).val()}),i.push({id:t.val,name:t.label})}),i},setValue:function(t){n.isArray(t)?t=n.pluck(t,"id"):n.isArray(t)||(t=[t]),this.$("input[type=checkbox]").val(t)}}),t.Form.editors.InlineNestedModel=t.Form.editors.Object.extend({initialize:function(e){if(t.Form.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var t=this.form.constructor,e=this.value||{},i=(this.key,this.schema.model),a=e.constructor===i?e:new i(e);return this.nestedForm=new t({model:a,idPrefix:this.id+"_",fieldTemplate:"nestedFieldInline",template:n.template('<div class="bbf-nested-form" data-fieldsets=""></div>')}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){return t.Form.prototype.commit.call(this.nestedForm)},validate:function(){return t.Form.prototype.validate.call(this.nestedForm)}}),t.Form.editors.Slider=t.Form.editors.Base.extend({initialize:function(t){if(i.Form.editors.Base.prototype.initialize.call(this,t),!this.schema||!this.schema.sliderOptions)throw new Error("Missing required 'schema.sliderOptions'");this.initSlider()},initSlider:function(){var t=this,e=this.schema.sliderOptions;this.$sliderContainer=s("<div class='slider-container well'><input name='"+this.key+"'/></div>"),this.$slider=this.$sliderContainer.find("input").slider(n.pick(e,function(t,e){return e in Slider.prototype.defaultOptions})).on("slide",function(){}).on("change",function(i){var a=i.value;return e.max_value&&a.newValue>e.max_value?(t.setValue(a.oldValue),void 0):e.min_value&&a.newValue<e.min_value?(t.$slider.setValue(a.oldValue),void 0):void 0}).data("slider")},render:function(){return this.$el.append(this.$sliderContainer),this},getValue:function(){return this.$slider.getValue()},setValue:function(t){this.$slider.setValue(t)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),t.Form.editors.Files=t.Form.editors.Base.extend({tagName:"div",className:"filesEditor-container",initialize:function(){n.bindAll(this,"fileAdd","fileRemove","fileInvalid","tooManyFiles","beforeUpload","uploadStart","uploadProgress","uploadComplete","uploadFail","uploadAbort","initUploader","destroyUploader"),t.Form.editors.Base.prototype.initialize.apply(this,arguments),this.files=new i.Collection(this.model.get(this.key))},getValue:function(){return this.files.toJSON()},setValue:function(t){if(!n(t).isArray())throw new Error("文件格式错误");this.files.set(t)},validate:function(){var e=this,i={type:"uploader",message:"文件正在上传，请稍后..."};return this.uploader&&0!=n.filter(this.files.models,function(t){return t.get("uploading")}).length?(new Juggler.Notify({message:"文件正在上传，请稍后..."},{delay:1e3}),setTimeout(function(){e.clearError()},500),i):t.Form.editors.Base.prototype.validate.apply(this)},clearError:function(){var t=this.form.$el.find("."+this.schema.fieldClass);t.find("[data-error]").empty(),t.removeClass("has-error")},render:function(){return this.uploader||(this.beforeInitUploader(),this.initUploader()),this},resetButtonState:function(t){this.form.complete=n.isUndefined(t)?this.files.where({uploading:!0}).length>0?!1:!0:t,this.form.setButtonState()},destroyUploader:function(){this.uploader.destroyAll()},beforeInitUploader:function(){var t=this.schema.getFilesView(),e='<span class="btn btn-default btn-file js-btn-uploader pull-left">'+this.schema.title+"</span>";this.filesView=new t({collection:this.files}),this.$el.append(e),this.$selectButton=this.$el.find(".js-btn-uploader"),this.$el.append(this.filesView.render().$el),this.$dropZone=this.filesView.$el},initUploader:function(){var t=this,e={acceptSize:[null,51200],errors:{invalidType:"文件：{{fileName}}格式无效，只能上传如下后缀的文件: {{allowedExtensions}}",sizeTooSmall:"文件：{{fileName}}太小了，请上传大于{{allowedMinSize}}的文件。",sizeTooLarge:"文件：{{fileName}}太大了，请重新上传小于{{allowedMaxSize}}的文件。",tooManyFiles:"无法上传文件：{{fileName}}，因为你一次只能上传{{maxFiles}}文件。",networkError:"在上传文件：{{fileName}}过程中出现异常，请重新上传。"},headers:{Accept:"application/json, text/javascript, */*; q=0.01"},selectButton:this.$selectButton,dropZone:this.$dropZone,multiple:!0};this.uploader=new Uploader(n.defaults(e,t.schema.uploaderOptions)),this.uploader.on("fileAdd",this.fileAdd).on("fileRemove",this.fileRemove).on("fileInvalid",this.fileInvalid).on("tooManyFile",this.tooManyFiles).on("beforeUpload",this.beforeUpload).on("uploadStart",this.uploadStart).on("uploadProgress",this.uploadProgress).on("uploadComplete",this.uploadComplete).on("uploadFail",this.uploadFail).on("uploadAbort",this.uploadAbort)},fileAdd:function(t,e,i){var a={uploading:!0,uniqueId:t,upload_time:Date.now()/1e3,del_flg:"0",name:i.name||e,size:i.size||null};
this.files.add(a),this.resetButtonState(!1)},fileRemove:function(){},fileInvalid:function(){this.resetButtonState()},tooManyFiles:function(){},beforeUpload:function(){console.log("beforeUpload")},uploadStart:function(){console.log("uploadStart")},uploadProgress:function(){console.log("uploadProgress")},uploadComplete:function(t,e,i,a){var s=this.files.findWhere({uniqueId:t});return i=JSON.parse(i),null!=a&&200!=a?(Spms.vent.trigger("message","系统异常，请联系管理员！"),this.resetButtonState(),void 0):n.isUndefined(i.error)?(s.unset("uploading",{silent:!0}).set({id:i.id}),this.trigger("change",this),this.resetButtonState(),void 0):(Spms.vent.trigger("message",i.error+":"+e),this.files.remove(s),this.resetButtonState(),void 0)},uploadFail:function(){},uploadAbort:function(){}}),t.Pills=e.Views.List.extend({className:"nav nav-pills"}),t.FilterItem=e.Views.Item.extend({onClick:function(t){var e=s.param(this.model.toJSON());i.history.navigate(e),t.preventDefault()}}),t.Filter=t.Pills.extend({childView:t.FilterItem,emptyView:e.Views.ItemView}),t.GroupItem=e.Views.Item.extend({className:"list-group-item"}),t.ListGroup=e.Views.List.extend({className:"list-group",childView:t.GroupItem}),t.Pagination=e.Views.List.extend({className:"pagination pull-right",defaults:{first:"&laquo;",prev:"&lsaquo;",next:"&rsaquo;",last:"&raquo;",totalPages:100,startPage:1,visiblePages:10},events:{"click .disabled a":"stop"},initialize:function(t){var e=this,i=this.collection;this.defaults.onPageClick=function(t,e){i.getPage(e)},this.options=n.extend(this.defaults,t),this.collection.unbind("reset").on("reset",this.pageable,this),this.options.model.on("change",function(){e.queryParams(),e.collection.fetch({reset:!0})}),this.collection.state&&this.collection.state.totalPages&&this.pageable()},render:function(){return this},pageable:function(){this.options.totalPages=this.collection.state.totalPages||1,this.options.startPage=this.collection.state.currentPage,this.options.totalRecords=this.collection.state.totalRecords,this.onDestroy(),this.options.totalPages>1&&this.$el.twbsPagination(this.options)},queryParams:function(){this.collection.queryParams=n.extend(this.collection.queryParams,this.options.model.toJSON())},onDestroy:function(){this.$el.data("twbs-pagination")&&this.$el.twbsPagination("destroy")},stop:function(t){return t.stopPropagation(),t.preventDefault(),!1}}),t.DataList=e.Views.Layout.extend({className:"data-list",template:e.Templates.datalist,FilterView:t.Filter,ListView:t.ListGroup,PaginationView:t.Pagination,initialize:function(t){var i=new e.Entities.Collection(t.filter||[]);this.filter=new this.FilterView({collection:i}),this.list=new this.ListView({collection:this.collection}),this.pagination=new this.PaginationView({collection:this.collection,model:t.filterModel||new e.Entities.Model})},onShow:function(){this.filterRegion.show(this.filter),this.listContentRegion.show(this.list),this.paginationRegion.show(this.pagination)}})}),Jma.module("Dicts",function(){}),Jma.module("Entities",function(){})(function(t,e){function i(){return new Date(Date.UTC.apply(Date,arguments))}function a(){var t=new Date;return i(t.getFullYear(),t.getMonth(),t.getDate())}function s(t){return function(){return this[t].apply(this,arguments)}}function n(e,i){function a(t,e){return e.toLowerCase()}var s,n=t(e).data(),o={},r=new RegExp("^"+i.toLowerCase()+"([A-Z])");i=new RegExp("^"+i.toLowerCase());for(var l in n)i.test(l)&&(s=l.replace(r,a),o[s]=n[l]);return o}function o(e){var i={};if(f[e]||(e=e.split("-")[0],f[e])){var a=f[e];return t.each(p,function(t,e){e in a&&(i[e]=a[e])}),i}}var r=t(window),l=function(){var e={get:function(t){return this.slice(t)[0]},contains:function(t){for(var e=t&&t.valueOf(),i=0,a=this.length;a>i;i++)if(this[i].valueOf()===e)return i;return-1},remove:function(t){this.splice(t,1)},replace:function(e){e&&(t.isArray(e)||(e=[e]),this.clear(),this.push.apply(this,e))},clear:function(){this.length=0},copy:function(){var t=new l;return t.replace(this),t}};return function(){var i=[];return i.push.apply(i,arguments),t.extend(i,e),i}}(),h=function(e,i){this.dates=new l,this.viewDate=a(),this.focusDate=null,this._process_options(i),this.element=t(e),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=t(m.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today, tfoot th.clear").attr("colspan",function(t,e){return parseInt(e)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};h.prototype={constructor:h,_process_options:function(e){this._o=t.extend({},this._o,e);var i=this.o=t.extend({},this._o),a=i.language;switch(f[a]||(a=a.split("-")[0],f[a]||(a=u.language)),i.language=a,i.startView){case 2:case"decade":i.startView=2;break;case 1:case"year":i.startView=1;break;default:i.startView=0}switch(i.minViewMode){case 1:case"months":i.minViewMode=1;break;case 2:case"years":i.minViewMode=2;break;default:i.minViewMode=0}i.startView=Math.max(i.startView,i.minViewMode),i.multidate!==!0&&(i.multidate=Number(i.multidate)||!1,i.multidate=i.multidate!==!1?Math.max(0,i.multidate):1),i.multidateSeparator=String(i.multidateSeparator),i.weekStart%=7,i.weekEnd=(i.weekStart+6)%7;var s=m.parseFormat(i.format);i.startDate!==-1/0&&(i.startDate=i.startDate?i.startDate instanceof Date?this._local_to_utc(this._zero_time(i.startDate)):m.parseDate(i.startDate,s,i.language):-1/0),1/0!==i.endDate&&(i.endDate=i.endDate?i.endDate instanceof Date?this._local_to_utc(this._zero_time(i.endDate)):m.parseDate(i.endDate,s,i.language):1/0),i.daysOfWeekDisabled=i.daysOfWeekDisabled||[],t.isArray(i.daysOfWeekDisabled)||(i.daysOfWeekDisabled=i.daysOfWeekDisabled.split(/[,\s]*/)),i.daysOfWeekDisabled=t.map(i.daysOfWeekDisabled,function(t){return parseInt(t,10)});var n=String(i.orientation).toLowerCase().split(/\s+/g),o=i.orientation.toLowerCase();if(n=t.grep(n,function(t){return/^auto|left|right|top|bottom$/.test(t)}),i.orientation={x:"auto",y:"auto"},o&&"auto"!==o)if(1===n.length)switch(n[0]){case"top":case"bottom":i.orientation.y=n[0];break;case"left":case"right":i.orientation.x=n[0]}else o=t.grep(n,function(t){return/^left|right$/.test(t)}),i.orientation.x=o[0]||"auto",o=t.grep(n,function(t){return/^top|bottom$/.test(t)}),i.orientation.y=o[0]||"auto";else;},_events:[],_secondaryEvents:[],_applyEvents:function(t){for(var i,a,s,n=0;n<t.length;n++)i=t[n][0],2===t[n].length?(a=e,s=t[n][1]):3===t[n].length&&(a=t[n][1],s=t[n][2]),i.on(s,a)},_unapplyEvents:function(t){for(var i,a,s,n=0;n<t.length;n++)i=t[n][0],2===t[n].length?(s=e,a=t[n][1]):3===t[n].length&&(s=t[n][1],a=t[n][2]),i.off(a,s)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:t.proxy(this.show,this),keyup:t.proxy(function(e){-1===t.inArray(e.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:t.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:t.proxy(this.show,this),keyup:t.proxy(function(e){-1===t.inArray(e.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:t.proxy(this.keydown,this)}],[this.component,{click:t.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:t.proxy(function(t){this._focused_from=t.target},this)}],[this.element,{blur:t.proxy(function(t){this._focused_from=t.target},this)}]),this._secondaryEvents=[[this.picker,{click:t.proxy(this.click,this)}],[t(window),{resize:t.proxy(this.place,this)}],[t(document),{"mousedown touchstart":t.proxy(function(t){this.element.is(t.target)||this.element.find(t.target).length||this.picker.is(t.target)||this.picker.find(t.target).length||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(e,i){var a=i||this.dates.get(-1),s=this._utc_to_local(a);this.element.trigger({type:e,date:s,dates:t.map(this.dates,this._utc_to_local),format:t.proxy(function(t,e){0===arguments.length?(t=this.dates.length-1,e=this.o.format):"string"==typeof t&&(e=t,t=this.dates.length-1),e=e||this.o.format;var i=this.dates.get(t);return m.formatDate(i,e,this.o.language)},this)})},show:function(){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.place(),this._attachSecondaryEvents(),this._trigger("show")},hide:function(){this.isInline||this.picker.is(":visible")&&(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},_utc_to_local:function(t){return t&&new Date(t.getTime()+6e4*t.getTimezoneOffset())},_local_to_utc:function(t){return t&&new Date(t.getTime()-6e4*t.getTimezoneOffset())},_zero_time:function(t){return t&&new Date(t.getFullYear(),t.getMonth(),t.getDate())},_zero_utc_time:function(t){return t&&new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()))},getDates:function(){return t.map(this.dates,this._utc_to_local)},getUTCDates:function(){return t.map(this.dates,function(t){return new Date(t)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){return new Date(this.dates.get(-1))},setDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,e),this._trigger("changeDate"),this.setValue()},setUTCDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,t.map(e,this._utc_to_local)),this._trigger("changeDate"),this.setValue()},setDate:s("setDates"),setUTCDate:s("setUTCDates"),setValue:function(){var t=this.getFormattedDate();if(this.isInput){var e=this.o.language;m.formatDate(this.dates[0],"yyyy",e)==m.formatDate(new Date(1970,1,1,0,0,0),"yyyy",e)&&(t=""),this.element.val(t).change()}else this.component&&this.element.find("input").val(t).change()},getFormattedDate:function(i){i===e&&(i=this.o.format);var a=this.o.language;return t.map(this.dates,function(t){return m.formatDate(t,i,a)}).join(this.o.multidateSeparator)},setStartDate:function(t){this._process_options({startDate:t}),this.update(),this.updateNavArrows()},setEndDate:function(t){this._process_options({endDate:t}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(t){this._process_options({daysOfWeekDisabled:t}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var e=this.picker.outerWidth(),i=this.picker.outerHeight(),a=10,s=r.width(),n=r.height(),o=r.scrollTop(),l=[];this.element.parents().each(function(){var e=t(this).css("z-index");"auto"!==e&&0!==e&&l.push(parseInt(e))});var h=Math.max.apply(Math,l)+10,d=this.component?this.component.parent().offset():this.element.offset(),c=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),u=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),p=d.left,f=d.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(p-=e-u)):(this.picker.addClass("datepicker-orient-left"),d.left<0?p-=d.left-a:d.left+e>s&&(p=s-e-a));var m,g,v=this.o.orientation.y;"auto"===v&&(m=-o+d.top-i,g=o+n-(d.top+c+i),v=Math.max(m,g)===g?"top":"bottom"),this.picker.addClass("datepicker-orient-"+v),"top"===v?f+=c:f-=i+parseInt(this.picker.css("padding-top")),this.picker.css({top:f,left:p,zIndex:h})}},_allow_update:!0,update:function(){if(this._allow_update){var e=this.dates.copy(),i=[],a=!1;arguments.length?(t.each(arguments,t.proxy(function(t,e){e instanceof Date&&(e=this._local_to_utc(e)),i.push(e)},this)),a=!0):(i=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),i=i&&this.o.multidate?i.split(this.o.multidateSeparator):[i],delete this.element.data().date),i=t.map(i,t.proxy(function(t){return m.parseDate(t,this.o.format,this.o.language)},this)),i=t.grep(i,t.proxy(function(t){return t<this.o.startDate||t>this.o.endDate||!t},this),!0),this.dates.replace(i),this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate&&(this.viewDate=new Date(this.o.endDate)),a?this.setValue():i.length&&String(e)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&e.length&&this._trigger("clearDate"),this.fill()}},fillDow:function(){var t=this.o.weekStart,e="<tr>";if(this.o.calendarWeeks){var i='<th class="cw">&nbsp;</th>';e+=i,this.picker.find(".datepicker-days thead tr:first-child").prepend(i)}for(;t<this.o.weekStart+7;)e+='<th class="dow">'+f[this.o.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;12>e;)t+='<span class="month">'+f[this.o.language].monthsShort[e++]+"</span>";this.picker.find(".datepicker-months td").html(t)},setRange:function(e){e&&e.length?this.range=t.map(e,function(t){return t.valueOf()}):delete this.range,this.fill()},getClassNames:function(e){var i=[],a=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),n=new Date;return e.getUTCFullYear()<a||e.getUTCFullYear()===a&&e.getUTCMonth()<s?i.push("old"):(e.getUTCFullYear()>a||e.getUTCFullYear()===a&&e.getUTCMonth()>s)&&i.push("new"),this.focusDate&&e.valueOf()===this.focusDate.valueOf()&&i.push("focused"),this.o.todayHighlight&&e.getUTCFullYear()===n.getFullYear()&&e.getUTCMonth()===n.getMonth()&&e.getUTCDate()===n.getDate()&&i.push("today"),-1!==this.dates.contains(e)&&i.push("active"),(e.valueOf()<this.o.startDate||e.valueOf()>this.o.endDate||-1!==t.inArray(e.getUTCDay(),this.o.daysOfWeekDisabled))&&i.push("disabled"),this.range&&(e>this.range[0]&&e<this.range[this.range.length-1]&&i.push("range"),-1!==t.inArray(e.valueOf(),this.range)&&i.push("selected")),i},fill:function(){this.viewDate.getTime()<864e5&&(this.viewDate=new Date);var a,s=new Date(this.viewDate),n=s.getUTCFullYear(),o=s.getUTCMonth(),r=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,l=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,h=1/0!==this.o.endDate?this.o.endDate.getUTCFullYear():1/0,d=1/0!==this.o.endDate?this.o.endDate.getUTCMonth():1/0,c=f[this.o.language].today||f.en.today||"",u=f[this.o.language].clear||f.en.clear||"";if(!isNaN(n)&&!isNaN(o)){this.picker.find(".datepicker-days thead th.datepicker-switch").text(f[this.o.language].months[o]+" "+n),this.picker.find("tfoot th.today").text(c).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot th.clear").text(u).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var p=i(n,o-1,28),g=m.getDaysInMonth(p.getUTCFullYear(),p.getUTCMonth());p.setUTCDate(g),p.setUTCDate(g-(p.getUTCDay()-this.o.weekStart+7)%7);var v=new Date(p);v.setUTCDate(v.getUTCDate()+42),v=v.valueOf();for(var y,w=[];p.valueOf()<v;){if(p.getUTCDay()===this.o.weekStart&&(w.push("<tr>"),this.o.calendarWeeks)){var b=new Date(+p+(this.o.weekStart-p.getUTCDay()-7)%7*864e5),D=new Date(Number(b)+(11-b.getUTCDay())%7*864e5),_=new Date(Number(_=i(D.getUTCFullYear(),0,1))+(11-_.getUTCDay())%7*864e5),k=(D-_)/864e5/7+1;w.push('<td class="cw">'+k+"</td>")}if(y=this.getClassNames(p),y.push("day"),this.o.beforeShowDay!==t.noop){var C=this.o.beforeShowDay(this._utc_to_local(p));C===e?C={}:"boolean"==typeof C?C={enabled:C}:"string"==typeof C&&(C={classes:C}),C.enabled===!1&&y.push("disabled"),C.classes&&(y=y.concat(C.classes.split(/\s+/))),C.tooltip&&(a=C.tooltip)}y=t.unique(y),w.push('<td class="'+y.join(" ")+'"'+(a?' title="'+a+'"':"")+">"+p.getUTCDate()+"</td>"),a=null,p.getUTCDay()===this.o.weekEnd&&w.push("</tr>"),p.setUTCDate(p.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(w.join(""));var T=this.picker.find(".datepicker-months").find("th:eq(1)").text(n).end().find("span").removeClass("active");t.each(this.dates,function(t,e){e.getUTCFullYear()===n&&T.eq(e.getUTCMonth()).addClass("active")}),(r>n||n>h)&&T.addClass("disabled"),n===r&&T.slice(0,l).addClass("disabled"),n===h&&T.slice(d+1).addClass("disabled"),w="",n=10*parseInt(n/10,10);var x=this.picker.find(".datepicker-years").find("th:eq(1)").text(n+"-"+(n+9)).end().find("td");n-=1;for(var F,U=t.map(this.dates,function(t){return t.getUTCFullYear()}),S=-1;11>S;S++)F=["year"],-1===S?F.push("old"):10===S&&F.push("new"),-1!==t.inArray(n,U)&&F.push("active"),(r>n||n>h)&&F.push("disabled"),w+='<span class="'+F.join(" ")+'">'+n+"</span>",n+=1;x.html(w)}},updateNavArrows:function(){if(this._allow_update){var t=new Date(this.viewDate),e=t.getUTCFullYear(),i=t.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-1/0&&e<=this.o.startDate.getUTCFullYear()&&i<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&e>=this.o.endDate.getUTCFullYear()&&i>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-1/0&&e<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&e>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}}},click:function(e){e.preventDefault();var a,s,n,o=t(e.target).closest("span, td, th");if(1===o.length)switch(o[0].nodeName.toLowerCase()){case"th":switch(o[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var r=m.modes[this.viewMode].navStep*("prev"===o[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,r),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,r),1===this.viewMode&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var l=new Date;l=i(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),this.showMode(-2);var h="linked"===this.o.todayBtn?null:"view";this._setDate(l,h);break;case"clear":var d;this.isInput?d=this.element:this.component&&(d=this.element.find("input")),d&&d.val("").change(),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()}break;case"span":o.is(".disabled")||(this.viewDate.setUTCDate(1),o.is(".month")?(n=1,s=o.parent().find("span").index(o),a=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(s),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(i(a,s,n))):(n=1,s=0,a=parseInt(o.text(),10)||0,this.viewDate.setUTCFullYear(a),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(i(a,s,n))),this.showMode(-1),this.fill());break;case"td":o.is(".day")&&!o.is(".disabled")&&(n=parseInt(o.text(),10)||1,a=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),o.is(".old")?0===s?(s=11,a-=1):s-=1:o.is(".new")&&(11===s?(s=0,a+=1):s+=1),this._setDate(i(a,s,n)))}this.picker.is(":visible")&&this._focused_from&&t(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(t){var e=this.dates.contains(t);if(t||this.dates.clear(),1===this.o.multidate&&0===e||(-1!==e?this.dates.remove(e):this.dates.push(t)),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(t,e){e&&"date"!==e||this._toggle_multidate(t&&new Date(t)),e&&"view"!==e||(this.viewDate=t&&new Date(t)),this.fill(),this.setValue(),this._trigger("changeDate");var i;this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&i.change(),!this.o.autoclose||e&&"date"!==e||this.hide()},moveMonth:function(t,i){if(!t)return e;if(!i)return t;var a,s,n=new Date(t.valueOf()),o=n.getUTCDate(),r=n.getUTCMonth(),l=Math.abs(i);if(i=i>0?1:-1,1===l)s=-1===i?function(){return n.getUTCMonth()===r}:function(){return n.getUTCMonth()!==a},a=r+i,n.setUTCMonth(a),(0>a||a>11)&&(a=(a+12)%12);else{for(var h=0;l>h;h++)n=this.moveMonth(n,i);a=n.getUTCMonth(),n.setUTCDate(o),s=function(){return a!==n.getUTCMonth()}}for(;s();)n.setUTCDate(--o),n.setUTCMonth(a);return n},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.o.startDate&&t<=this.o.endDate},keydown:function(t){if(this.picker.is(":not(:visible)"))return 27===t.keyCode&&this.show(),void 0;var e,i,s,n=!1,o=this.focusDate||this.viewDate;switch(t.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),t.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;e=37===t.keyCode?-1:1,t.ctrlKey?(i=this.moveYear(this.dates.get(-1)||a(),e),s=this.moveYear(o,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(i=this.moveMonth(this.dates.get(-1)||a(),e),s=this.moveMonth(o,e),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||a()),i.setUTCDate(i.getUTCDate()+e),s=new Date(o),s.setUTCDate(o.getUTCDate()+e)),this.dateWithinRange(i)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),t.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;e=38===t.keyCode?-1:1,t.ctrlKey?(i=this.moveYear(this.dates.get(-1)||a(),e),s=this.moveYear(o,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(i=this.moveMonth(this.dates.get(-1)||a(),e),s=this.moveMonth(o,e),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||a()),i.setUTCDate(i.getUTCDate()+7*e),s=new Date(o),s.setUTCDate(o.getUTCDate()+7*e)),this.dateWithinRange(i)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),t.preventDefault());break;case 32:break;case 13:o=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(o),n=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(t.preventDefault(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(n){this.dates.length?this._trigger("changeDate"):this._trigger("clearDate");var r;this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r&&r.change()}},showMode:function(t){t&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+t))),this.picker.find(">div").hide().filter(".datepicker-"+m.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var d=function(e,i){this.element=t(e),this.inputs=t.map(i.inputs,function(t){return t.jquery?t[0]:t}),delete i.inputs,t(this.inputs).datepicker(i).bind("changeDate",t.proxy(this.dateUpdated,this)),this.pickers=t.map(this.inputs,function(e){return t(e).data("datepicker")}),this.updateDates()};d.prototype={updateDates:function(){this.dates=t.map(this.pickers,function(t){return t.getUTCDate()}),this.updateRanges()},updateRanges:function(){var e=t.map(this.dates,function(t){return t.valueOf()});t.each(this.pickers,function(t,i){i.setRange(e)})},dateUpdated:function(e){if(!this.updating){this.updating=!0;var i=t(e.target).data("datepicker"),a=i.getUTCDate(),s=t.inArray(e.target,this.inputs),n=this.inputs.length;if(-1!==s){if(t.each(this.pickers,function(t,e){e.getUTCDate()||e.setUTCDate(a)}),a<this.dates[s])for(;s>=0&&a<this.dates[s];)this.pickers[s--].setUTCDate(a);else if(a>this.dates[s])for(;n>s&&a>this.dates[s];)this.pickers[s++].setUTCDate(a);this.updateDates(),delete this.updating}}},remove:function(){t.map(this.pickers,function(t){t.remove()}),delete this.element.data().datepicker}};var c=t.fn.datepicker;t.fn.datepicker=function(i){var a=Array.apply(null,arguments);a.shift();var s;return this.each(function(){var r=t(this),l=r.data("datepicker"),c="object"==typeof i&&i;if(!l){var p=n(this,"date"),f=t.extend({},u,p,c),m=o(f.language),g=t.extend({},u,m,p,c);if(r.is(".input-daterange")||g.inputs){var v={inputs:g.inputs||r.find("input").toArray()};r.data("datepicker",l=new d(this,t.extend(g,v)))}else r.data("datepicker",l=new h(this,g))}return"string"==typeof i&&"function"==typeof l[i]&&(s=l[i].apply(l,a),s!==e)?!1:void 0}),s!==e?s:this};var u=t.fn.datepicker.defaults={autoclose:!1,beforeShowDay:t.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},p=t.fn.datepicker.locale_opts=["format","rtl","weekStart"];t.fn.datepicker.Constructor=h;var f=t.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},m={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(t){return t%4===0&&t%100!==0||t%400===0},getDaysInMonth:function(t,e){return[31,m.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(t){var e=t.replace(this.validParts,"\x00").split("\x00"),i=t.match(this.validParts);if(!e||!e.length||!i||0===i.length)throw new Error("Invalid date format.");return{separators:e,parts:i}},parseDate:function(a,s,n){function o(){var t=this.slice(0,u[d].length),e=u[d].slice(0,t.length);return t===e}if(!a)return e;if(a instanceof Date)return a;"string"==typeof s&&(s=m.parseFormat(s));var r,l,d,c=/([\-+]\d+)([dmwy])/,u=a.match(/([\-+]\d+)([dmwy])/g);if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(a)){for(a=new Date,d=0;d<u.length;d++)switch(r=c.exec(u[d]),l=parseInt(r[1]),r[2]){case"d":a.setUTCDate(a.getUTCDate()+l);break;case"m":a=h.prototype.moveMonth.call(h.prototype,a,l);break;case"w":a.setUTCDate(a.getUTCDate()+7*l);break;case"y":a=h.prototype.moveYear.call(h.prototype,a,l)}return i(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),0,0,0)}u=a&&a.match(this.nonpunctuation)||[],a=new Date;var p,g,v={},y=["yyyy","yy","M","MM","m","mm","d","dd"],w={yyyy:function(t,e){return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){if(isNaN(t))return t;for(e-=1;0>e;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!==e;)t.setUTCDate(t.getUTCDate()-1);return t},d:function(t,e){return t.setUTCDate(e)}};w.M=w.MM=w.mm=w.m,w.dd=w.d,a=i(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0);var b=s.parts.slice();if(u.length!==b.length&&(b=t(b).filter(function(e,i){return-1!==t.inArray(i,y)}).toArray()),u.length===b.length){var D;for(d=0,D=b.length;D>d;d++){if(p=parseInt(u[d],10),r=b[d],isNaN(p))switch(r){case"MM":g=t(f[n].months).filter(o),p=t.inArray(g[0],f[n].months)+1;break;case"M":g=t(f[n].monthsShort).filter(o),p=t.inArray(g[0],f[n].monthsShort)+1}v[r]=p}var _,k;for(d=0;d<y.length;d++)k=y[d],k in v&&!isNaN(v[k])&&(_=new Date(a),w[k](_,v[k]),isNaN(_)||(a=_))}return a},formatDate:function(e,i,a){if(!e)return"";"string"==typeof i&&(i=m.parseFormat(i));var s={d:e.getUTCDate(),D:f[a].daysShort[e.getUTCDay()],DD:f[a].days[e.getUTCDay()],m:e.getUTCMonth()+1,M:f[a].monthsShort[e.getUTCMonth()],MM:f[a].months[e.getUTCMonth()],yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear()};s.dd=(s.d<10?"0":"")+s.d,s.mm=(s.m<10?"0":"")+s.m,e=[];for(var n=t.extend([],i.separators),o=0,r=i.parts.length;r>=o;o++)n.length&&e.push(n.shift()),e.push(s[i.parts[o]]);return e.join("")},headTemplate:'<thead><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};m.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+m.headTemplate+"<tbody></tbody>"+m.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+"</table></div></div>",t.fn.datepicker.DPGlobal=m,t.fn.datepicker.noConflict=function(){return t.fn.datepicker=c,this},t(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(e){var i=t(this);i.data("datepicker")||(e.preventDefault(),i.datepicker("show"))}),t(function(){t('[data-provide="datepicker-inline"]').datepicker()})}(window.jQuery)),Jma.module("Funcs",function(t,e){e.fixedNum=function(t,e){0>e&&(e=0);var i=Math.round(parseFloat(t)*Math.pow(10,e+1)/10)/Math.pow(10,e),a=i.toString().split(".")[1]?i.toString().split(".")[1].length:0;if(isNaN(i))return"0.00";0==a&&0!==e&&(i+=".");for(var s=a;e>s;s++)i=i.toString()+"0";return i+""},e.getDate=function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,a=t.getDate(),s=t.getDay(),n=e+"-"+i+"-"+a;return{date:{riqi:n,weekday:"星期"+s}}},e.getWeekDay=function(t){var e=new Date(t),i="";switch(e.getDay()){case 1:i="星期一";break;case 2:i="星期二";break;case 3:i="星期三";break;case 4:i="星期四";break;case 5:i="星期五";break;case 6:i="星期六";break;case 7:i="星期日"}return i}}),function(t,e){if("function"==typeof define&&define.amd)define(["marionette","backbone","underscore"],function(i,a,s){return t.Jma=e(t,i,a,s)});else if("undefined"!=typeof exports){var i=require("marionette"),a=require("backbone"),s=require("underscore");module.exports=e(t,i,a,s)}else t.Jma=e(t,t.Marionette,t.Backbone,t._)}(this,function(t,e,i){"use strict";var a=new e.Application;return a.VERSION="0.0.0",a.addInitializer(function(){a.addRegions({navRegion:"#nav",headerRegion:"#header",mainRegion:"#main",footerRegion:"#footer"})}),a.AppRouter=e.AppRouter.extend({onRoute:function(t,e,i){var s={name:t,path:e,args:i};a.commands.execute("change:Router",s)}}),a.on("start",function(){i.history&&i.history.start()}),a}),Jma.module("Router",function(t,e,i,a){t.startWithParent=!0,t.Router=e.AppRouter.extend({appRoutes:{"":"index"}}),t.Controller=a.Controller.extend({index:function(){i.history.navigate("#index"),e.Regist.StartApp()},post:function(){console.log(123),e.Post.StartApp()}}),t.on("start",function(){new t.Router({controller:new t.Controller})})}),$(function(){Jma.start()}),Jma.module("Templates",function(t,e,i,a,s,n){t.Form_Field_template_0_12=n.template('    <div class="form-group field-<%= key %>">      <div class="col-sm-12 project-form-value">      <span data-editor></span>      <p class="help-block" data-error></p>      <p class="help-block"><%= help %></p>      </div>    </div>  '),t.datalist=n.template('    <div data-region="filter"></div>    <div data-region="list-content"></div>    <div data-region="pagination"></div>  '),t.emptyTemplate=n.template('    <div class="loading"><img src="/public/images/new_osn/loading.gif"/> loading</div>  '),t.Form_Field_template_3_9_nomax_tips=n.template('      <div class="form-group field-<%= key %>">        <label class="col-xs-3 control-label" for="<%= editorId %>"><%= description %> <%= title %></label>        <div class="col-xs-9">        <span data-editor></span>        </div>      </div>    ')
}),Jma.module("Views",function(t,e,i,a,s,n){t.Layout=a.LayoutView.extend({template:"demo",render:function(){var t=this;return this.resolveUIRegions(),a.LayoutView.prototype.render.apply(this,arguments),this.$("[data-region]").each(function(e,i){var a=s(i).attr("data-region"),n=s.camelCase(a);n&&t.addRegion(n+"Region",{el:s(i)})}),this},resolveUIRegions:function(){if(this.ui)for(var t in this.ui)this.addRegion(t+"Region",this.ui[t])},resolveTemplateRegions:function(){var t=this,e=this.regionAttr,i="["+e+"]";this.$el.find(i).each(function(i,a){var n=s(a).attr(e);n&&t.addRegion(s.camelCase(n)+"Region","["+e+"="+n+"]")}),this.triggerMethod("resoveregion")},serializeData:function(){var t=a.LayoutView.prototype.serializeData.apply(this,arguments);return n.size(t)&&t||this.options}}),t.ItemView=a.ItemView.extend({constructor:function(t){this.options=n.defaults(t,n.result(this.defaults)),a.ItemView.prototype.constructor.apply(this,arguments)},template:n.template("")}),t.CompositeView=a.CompositeView.extend({emptyView:t.EmptyView,childViewContainer:"",template:n.template(""),getChildView:function(e){return t[e.get("viewType")]||a.getOption(this,"childView")||this.constructor}}),t.Item=t.ItemView.extend({tagName:"li",template:n.template('<a href="#<%- value %>"><%= name %></a>'),ui:{links:"a",buttons:".btn",editClass:".js-edit",deleteClass:".js-delete"},events:{"click @ui.links":"onClick","click @ui.buttons":"onPress"},triggers:{"click @ui.editClass":"edit","click @ui.deleteClass":"delete"},onClick:function(){this.trigger("clicked",this.model)},onPress:function(){this.trigger("pressed",this.model)}}),t.List=t.CompositeView.extend({tagName:"ul",template:n.template(""),childView:t.Item}),t.EmptyView=a.ItemView.extend({template:e.Templates.emptyTemplate})}),$.notifyDefaults({type:"warning",placement:{align:"center"},mouse_over:"pause",z_index:9999,template:'<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"><span aria-hidden="true" class="fa fa-remove"></span><span class="sr-only">Close</span></button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'}),Jma.Notify=$.notify,Jma.Dialog=BootstrapDialog,Jma.Dialog.confirm=function(t,e){return $(document).addClass("overflow"),new BootstrapDialog({title:"确认",message:t,cssClass:"confirm-dialog",closable:!0,data:{callback:e},buttons:[{label:"取消",action:function(t){"function"==typeof t.getData("callback")&&t.getData("callback")(!1),$(document).removeClass("overflow"),t.close()}},{label:"确定",cssClass:"btn-success",action:function(t){"function"==typeof t.getData("callback")&&t.getData("callback")(!0),$(document).removeClass("overflow"),t.close()}}]}).open()},Jma.Dialog.alert=function(t,e){return new BootstrapDialog({title:"警告",message:t,cssClass:"confirm-dialog",closable:!0,data:{callback:e},buttons:[{label:"确定",cssClass:"btn-success",action:function(t){"function"==typeof t.getData("callback")&&t.getData("callback")(!0),t.close()}}]}).open()},Jma.Dialog.configDefaultOptions({title:"提示：",closeByBackdrop:!1}),Jma.Controller=Marionette.Controller.extend({Layout:Marionette.LayoutView,getLayout:function(){return this.layout=this.layout||new this.Layout,this.layout}});