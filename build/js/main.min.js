Jma.module("Components",function(e,t,i,s,a,n){e.Dicts={},e.Dicts.emojis=["smile","iphone","girl","smiley","heart","kiss","copyright","coffee","a","ab","airplane","alien","ambulance","angel","anger","angry","arrow_forward","arrow_left","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","art","astonished","atm","b","baby","baby_chick","baby_symbol","balloon","bamboo","bank","barber","baseball","basketball","bath","bear","beer","beers","beginner","bell","bento","bike","bikini","bird","birthday","black_square","blue_car","blue_heart","blush","boar","boat","bomb","book","boot","bouquet","bow","bowtie","boy","bread","briefcase","broken_heart","bug","bulb","person_with_blond_hair","phone","pig","pill","pisces","plus1","point_down","point_left","point_right","point_up","point_up_2","police_car","poop","post_office","postbox","pray","princess","punch","purple_heart","question","rabbit","racehorse","radio","up","us","v","vhs","vibration_mode","virgo","vs","walking","warning","watermelon","wave","wc","wedding","whale","wheelchair","white_square","wind_chime","wink","wink2","wolf","woman","womans_hat","womens","x","yellow_heart","zap","zzz","+1","-1"],e.Form=e.Form||{},e.Form.editors=e.Form.editors||{},i.Form.Field=i.Form.Field.extend({templateData:function(){var e=this.schema;return{help:e.help||"",title:e.title,description:e.description?'<span class="form-tips">'+e.description+"</span>":"",titleHTML:e.titleHTML,fieldAttrs:e.fieldAttrs,editorAttrs:e.editorAttrs,key:this.key,editorId:this.editor.id}}}),e.Form=i.Form.extend({events:{submit:"onSubmit","click .cancel-btn":"onCancel"},template:n.template('        <form class="form-horizontal" role="form">          <div data-fieldsets></div>          <div class="form-group form-bar"><div class="col-md-12">            <button class="btn btn-success" type="submit">提交</button>            <button class="btn btn-default cancel-btn" type="button">取消</button>          </div></div>        </form>      '),initialize:function(e){i.Form.prototype.initialize.apply(this,arguments),this.options=n.extend({submitButton:"提交"},e),this.errors={},this.complete=!0,this.submitButton=null,t.Components.Form.validators.required=function(e){return e=n.extend({type:"required",message:t.Components.Form.validators.errMessages.required},e),function(t){e.value=t;var i={type:e.type,message:n.isFunction(e.message)?e.message(e):e.message};return"-0"===t||null===t||void 0===t||t===!1||""===t||n.isArray(t)&&0===t.length?i:void 0}},this.on("field:change field:blur",this.validateField,this),this.on("validate",this.setButtonState,this),this.model&&this.model.on("request",this.onRequest,this),this.model&&this.model.unbind("change")&&this.model.on("change",this.onModelChange,this),this.model&&!this.model.isNew()&&this.options.patch&&(this.old_model=this.model.clone())},handleEditorEvent:function(e,t){i.Form.prototype.handleEditorEvent.apply(this,arguments),this.trigger("field:"+e,t.key)},validate:function(){var e=i.Form.prototype.validate.apply(this,arguments);return this.errors=null==e?{}:e,this.trigger("validate",this.errors),e},validateField:function(e){if(this.submitButton){var t=this.fields[e].validate();return t?this.errors[e]=t:delete this.errors[e],this.trigger("validate",this.errors),this.errors}},validateEditors:function(){for(var e in this.fields){var t=this.fields[e].editor.validate();t&&(this.errors[e]=t)}return this.trigger("validate",this.errors),this.errors},setButtonState:function(){n.isEmpty(this.errors)&&this.complete?this.submitButton.removeClass("disabled").removeAttr("disabled").html(this.options.submitButton):this.submitButton.addClass("disabled").attr("disabled","disabled")&&this.options.processing&&this.submitButton.html('<i class="fa fa-refresh fa-spin"></i> '+this.options.processing)},render:function(){return i.Form.prototype.render.apply(this,arguments),this.trigger("render"),this.values=this.getValue(),this.submitButton=this.$el.find(":submit"),this.validateEditors(),this},onShow:function(){this.$el.find(".form-tips").children().addClass("text-muted").tooltip({container:"body"})},resetValue:function(){this.setValue(this.values)},templateData:function(){var e={submitButton:this.options.submitButton};return e},onSubmit:function(e){var t=this;if(e.preventDefault(),!this.commit()){var i,s={success:function(e,i){t.trigger("success",{model:e,response:i})},error:function(e,i){t.trigger("error",{model:e,response:i})}};if(!("placeholder"in document.createElement("input"))){var a=this.model.schema?this.model.schema:this.options.schema;n.each(a,function(e,i){e.editorAttrs&&e.editorAttrs.placeholder&&t.model.get(i)==e.editorAttrs.placeholder&&t.model.set(i,"")})}if(!this.model.isNew()&&this.options.patch){this.options.patch&&(s.patch=!0);var o=this.old_model.changedAttributes(this.model.toJSON());if(!(n.size(o)>0))return this.complete=!0,this.setButtonState(),void 0;i=this.model.save(o,s)}else i=this.model.save(this.model.toJSON(),s);i.always(function(){t.complete=!0,t.setButtonState()})}},onModelChange:function(){var e=this.model.toJSON();this.setValue(e),this.validateEditors(),this.setButtonState()},onRequest:function(){var e=this;e.complete=!1,this.setButtonState()},onCancel:function(){this.trigger("form:cancel")}}),e.Form.editors.DatePicker=e.Form.editors.Text.extend({defaultValue:"",previousValue:"",defaults:{format:"yyyy-mm-dd",autoclose:!0,language:"zh-CN",todayBtn:!1},events:{keyup:"determineChange",keypress:function(){var e=this;setTimeout(function(){e.determineChange()},0)},select:function(){this.trigger("select",this)},focus:function(){},blur:function(){}},initialize:function(t){var i=this;e.Form.editors.Text.prototype.initialize.call(this,t),this.value=this.defaultValue,this.value=(new Date).getTime()/1e3,this.defaultValue=this.value,this.$el.addClass("datepicker-input"),this.$el.datepicker(n.extend(n.clone(this.defaults),this.schema.options)).on("changeDate",function(e){i.value=parseInt(e.date.getTime()/1e3),i.checkChange()}).on("clearDate",function(){i.setValue("-0")}),this.DatePicker=this.$el.data("datepicker"),this.setValue(this.value)},determineChange:function(){},getValue:function(){return this.value},setValue:function(e){if(this.value=""==e?"-0":e,"-0"==this.value)return this.value;var t=new Date(1e3*e);this.DatePicker.setDate(t)},checkChange:function(t){e.Form.editors.Text.prototype.determineChange.call(this,t)}}),e.Form.editors.NotNullDatePicker=e.Form.editors.Text.extend({defaultValue:"",defaults:{format:"yyyy-mm-dd",autoclose:!0,language:"zh-CN",todayBtn:!1},initialize:function(t){var i=this;e.Form.editors.Text.prototype.initialize.call(this,t),this.value=this.defaultValue,this.defaultValue=this.value,this.$el.addClass("datepicker-input"),this.options=n.defaults(t,this.defaults),this.$el.datepicker(this.options).on("hide",function(e){"undefined"==typeof e.date?i.setValue(parseInt((new Date).getTime()/1e3)):(i.value=parseInt(e.date.getTime()/1e3),i.form&&i.form.trigger(i.options.key+":change",i.form,i)||i.trigger("change",i))}).on("changeDate",function(e){"undefined"==typeof e.date?i.setValue(parseInt((new Date).getTime()/1e3)):(i.value=parseInt(e.date.getTime()/1e3),i.form&&i.form.trigger(i.options.key+":change",i.form,i)||i.trigger("change",i))}),this.DatePicker=this.$el.data("datepicker"),this.setValue(this.value)},determineChange:function(){},getValue:function(){return this.value},setValue:function(e){this.value=e;var t=new Date(1e3*e);this.DatePicker.setDate(t)}}),e.Form.editors.TagsInput=e.Form.editors.Text.extend({defaults:{freeInput:!0,itemValue:"id",itemText:"name"},Collection:i.Collection,initialize:function(t){var i=this;if(this.$el.on("change",function(){i.trigger("change",i),a(i.$el).parents(".form-group").hasClass("has-error")?a(i.$el).parents(".form-group").find(".bootstrap-tagsinput").css({border:"1px red solid"}):a(i.$el).parents(".form-group").find(".bootstrap-tagsinput").css({border:"1px solid #ccc"})}),e.Form.editors.Text.prototype.initialize.call(this,t),this.defaults.items)var s=this.defaults.items;else var s=8;this.collection=t.schema.collection||this.collection||new this.Collection,this.options={},t.schema.options&&(this.options=t.schema.options),this.options=n.extend(this.options,this.defaults,{typeahead:{source:function(e){var t=a.Deferred();return i.collection.on("reset",function(){t.resolve(this.toJSON())}),i.collection.fetch({data:{s:e},reset:!0}),t},matcher:function(e){return e},items:s},tagClass:this.tagClass},t.schema.tagsinput),this.form.on("render",this.onRender,this)},tagClass:function(){return"label label-info"},getValue:function(){return this.$el.tagsinput("items")},setValue:function(e){var t=this;n.isArray(e)&&n.each(e,function(e){t.$el.tagsinput("add",e)})},render:function(){return this},onRender:function(){var e=this;this.$el.tagsinput(this.options),this.setValue(this.value),a(this.$el).parent().delegate(".bootstrap-tagsinput input","blur",function(){e.$el.blur(),a(e.$el).parents(".form-group").hasClass("has-error")?a(this).parents(".bootstrap-tagsinput").css({border:"1px red solid"}):a(this).parents(".bootstrap-tagsinput").css({border:"1px solid #ccc"})})},remove:function(){this.$el.datepicker("remove"),e.Form.editors.Text.prototype.remove.apply(this,arguments)},addItem:function(e){this.$el.tagsinput("add",e)}}),e.Form.editors.BaseUploader=e.Form.editors.Base.extend({defaults:{multiple:!0,params:{app_type:"Ehrs_app_spms",app_id:"project_tmp_id"},url:"/devp/uploader/upload.php"},initialize:function(s){n.bindAll(this,"fileAdd","fileRemove","fileInvalid","tooManyFile","beforeUpload","uploadStart","uploadAbort","uploadComplete","uploadError","uploadProgress","render","_showAttaches","initUploader"),e.Form.editors.Base.prototype.initialize.apply(this,arguments),n.extend(this,this.defaults,n.pick(s.schema,"url","title","params","multiple","collectionName","viewsName","button","dropZone")),this.collectionName=this.collectionName||i.Collection,this.viewsName=this.viewsName||t.Views.AttachesView,this.collection=new this.collectionName(this.model.get(this.key)),this.collection.on("add remove reset",this._showAttaches),this.initUploader()},validate:function(){var e={type:"uploader",message:"文件正在上传，请稍后..."};return this.uploader&&this.uploader.countFiles("UPLOADING")?e:void 0},initUploader:function(){this.uploader=new Uploader({selectButton:this.button,url:this.url,data:this.params,acceptSize:[null,51200],dropZone:this.dropZone,errors:{invalidType:"The file '{{fileName}}' is not valid. Please upload only files with the following extensions: {{allowedExtensions}}.",sizeTooSmall:"The file '{{fileName}}' is too small. Please upload only files bigger than {{allowedMinSize}}.",sizeTooLarge:"文件：'{{fileName}}'太大了,请重新上传小于50MB的文件.",tooManyFiles:"Can not upload the file '{{fileName}}'', because you can upload only {{maxFiles}} file(s).",networkError:"There was a problem uploading the file '{{fileName}}'. Please try uploading that file again."},headers:{Accept:"application/json, text/javascript, */*; q=0.01"}}),this.uploader.on("fileAdd",this.fileAdd).on("fileRemove",this.fileRemove).on("fileInvalid",this.fileInvalid).on("tooManyFile",this.tooManyFile).on("beforeUpload",this.beforeUpload).on("uploadStart",this.uploadStart).on("uploadProgress",this.uploadProgress).on("uploadAbort",this.uploadAbort).on("uploadComplete",this.uploadComplete).on("uploadFail",this.uploadError)},destroy:function(){this.uploader.destroyAll()},_showAttaches:function(){0==this.collection.length?this.$el.hide():this.$el.show()},render:function(){return this._initAttachesView(),this.$el.html(this.attachesView.$el),this._showAttaches(),this},_initAttachesView:function(){this.attachesView||(this.attachesView=new this.viewsName({collection:this.collection}),this.attachesView.render(),this.attachesView.on("childview:removeAttach",function(e,t){t.model.destroy()}))},getValue:function(){return this.collection.toJSON()},setValue:function(e){if(!n(e).isArray())throw new Error("文件格式错误");this.collection.reset(e)},addUploaded:function(e){this.collection.add(e)},removeUploaded:function(e){this.setValue(n.reject(this.getValue(),function(t){return t.id==e}))},updateList:function(){},fileInvalid:function(){},tooManyFile:function(){},beforeUpload:function(){},uploadStart:function(){},uploadComplete:function(e,t,i,s){if(200==s){i=JSON.parse(i);var a=n.pick(i,"id","name","file_size","file_type","show_name","type");"Ehrs_n_image"==i.file_type&&(a.thumb=i.append.thumbnails.link),this.collection.get(e).clear({silent:!0}).set(a)}},uploadError:function(){},uploadProgress:function(e,t,i,s){this.collection.get(e)&&this.collection.get(e).set({loaded:i,total:s})},fileAdd:function(e,t,i){this.collection.add(n.extend({},i,{id:e,uploading:!0}))},fileRemove:function(){},uploadAbort:function(){}}),e.Form.editors.CheckboxTextArea=e.Form.editors.Text.extend({tagName:"textarea",events:{keydown:"getTextareaValue",keyup:"setTextareaValue"},getTextareaValue:function(){this.val=this.$el.val(),""!=this.val&&","!=this.val.split("")[this.val.length-1]&&(this.val=this.val+","),this.$el.val("")},setTextareaValue:function(){this.$el.val(this.val)},initialize:function(){},reder:function(){return this}}),e.Form.editors.Integer=e.Form.editors.Number.extend({onKeyPress:function(e){var t=this,i=function(){setTimeout(function(){t.determineChange()},0)};if(0===e.charCode)return i(),void 0;var s=this.$el.val();void 0!=e.charCode&&(s+=String.fromCharCode(e.charCode));var a=/^[0-9]*?$/.test(s);a?i():e.preventDefault()}}),e.Form.editors.BootstrapSelect=e.Form.editors.Select.extend({className:"btn-group split-dropdown-menu",tagName:"div",events:{change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)},"click li a":"select"},initialize:function(t){e.Form.editors.Select.prototype.initialize.call(this,t),this.template=t.template||this.constructor.template},render:function(){return this.schema=n.extend({},{style:"default"},this.schema),this.$el.append(this.template({action:this.schema.options[0],style:this.schema.style})),this.setOptions(this.schema.options),"undefined"==typeof this.schema.size&&(this.schema.size=1),this.schema.disabled&&this.$el.find("button").attr("disabled","true"),this.$el.attr("size",this.schema.size),this},select:function(e){e.preventDefault(),this.setValue(a(e.target).attr("value")),this.trigger("change",this)},getValue:function(){var e=this.schema.options,t=this.$(".btn-actionname").html(),s=this.$(".btn-actionname").data("value");if(n.isArray(e)){t||(t=e[0].label);var a=n.findWhere(e,{label:t});return a?a.val:""}return e instanceof i.Collection?s:n.findWhere(e,{label:t})},setValue:function(e){var t,s=this.schema.options;if(s instanceof i.Collection)s.length>0?(e=n.isUndefined(e)||n.isUndefined(s.get(e))?s.at(0).get("id"):e,t=s.get(e).get(this.getkeys().label)):t="";else if(n.isArray(s)||n.isObject(s))if(e||(e=s[0].val),"number"==typeof s[0].val&&(e=parseInt(e)),"object"==typeof e&&(e=e.id),""==e)t="";else{var a=n.findWhere(s,{val:e});t=a?a.label:""}else t=e;""==t&&(t="&nbsp;"),this.$(".btn-actionname").html(t),this.$(".btn-actionname").data("value",e)},getkeys:function(){return"undefined"==typeof this.schema.labelval?{val:"val",label:"label"}:this.schema.labelval},renderOptions:function(e){var t,s=this.$el.find(".dropdown-menu");if(e instanceof i.Collection){e=e.toJSON();var a=this.schema.labelval;if(e[0]){if("undefined"==typeof a)var o={val:"val",label:"label"};else var o=a;e=n.map(e,function(e){return{val:e[o.val],label:e[o.label]}})}else e=[{val:"",label:"请选择"}]}t=this._getOptionsHtml(e),s.html(t),this.setValue(this.value)},_arrayToHtml:function(e){var t=[];return n.each(e,function(e){if(n.isObject(e))if(e.group)t.push('<optgroup label="'+e.group+'">'),t.push(this._getOptionsHtml(e.options)),t.push("</optgroup>");else{var i=e.val||0===e.val?e.val:"",s=e.level||2==e.level?"&nbsp;&nbsp;&nbsp;&nbsp;"+e.label:e.label;t.push('<li title="'+s+'"><a class="ellipsis" href="#" value="'+i+'">'+s+"</a></li>")}else t.push('<li title="'+e+'"><a class="ellipsis" href="#" value="'+e+'">'+e+"</a></li>")},this),t.join("")}},{template:n.template('      <button type="button" class="btn btn-<%= style %> btn-actionname ellipsis yjl-btn yjl-title"><%= action %></button>      <button type="button" class="btn btn-<%= style %> dropdown-toggle yjl-title-btn" data-toggle="dropdown" aria-expanded="false">      <span class="caret"></span>      <span class="sr-only">Toggle Dropdown</span>      </button>      <ul class="dropdown-menu" role="menu"></ul>    ',null,e.Form.templateSettings)}),e.Form.editors.setSelect=e.Form.editors.Select.extend({render:function(){return this.setOptions(this.schema.options),this},renderOptions:function(e){var t=this.schema.labelval;if(e instanceof i.Collection&&(e=e.toJSON()),e[0]){if("undefined"==typeof t)var s={val:"val",label:"label"};else var s=t;e=n.map(e,function(e){return{val:e[s.val],label:e[s.label]}})}else e=[{val:0,label:"请选择"}];var a,o=this.$el;a=this._getOptionsHtml(e),o.html(a),this.value?this.setValue(this.value):this.setValue(e[0].val)}}),e.Form.editors.BootstrapCheckboxes=e.Form.editors.Checkboxes.extend({className:"BootstrapCheckboxes",_arrayToHtml:function(e){var t=a(),i=this;return this._array=e,n.each(e,function(e,s){var o=a("<li>");if(i.schema.liClass&&o.addClass(i.schema.liClass),n.isObject(e))if(e.group){var r=i.id;i.id+="-"+i.groupNumber++,o=a('<fieldset class="group">').append(a("<legend>").text(e.group)),o=o.append(i._arrayToHtml(e.options)),i.id=r,close=!1}else{var l=e.val||0===e.val?e.val:"";e.labelHTML?o.append(a('<label for="'+i.id+"-"+s+'">').html(e.labelHTML)):o.append(a('<label for="'+i.id+"-"+s+'">').text(e.label)),o.find("label").prepend(a('<input type="checkbox" name="'+i.getName()+'" id="'+i.id+"-"+s+'" />').val(l))}else o.append(a('<label for="'+i.id+"-"+s+'">').text(e)),o.find("label").prepend(a('<input type="checkbox" name="'+i.getName()+'" id="'+i.id+"-"+s+'" />').val(e));t=t.add(o)}),0==e.length&&this.schema.nullTip&&(t=a('<li><span class="nullTip">'+this.schema.nullTip+"</span></li>")),t}}),e.Form.editors.BBC=e.Form.editors.Base.extend({initialize:function(t){if(e.Form.editors.Base.prototype.initialize.apply(this,arguments),n.extend(this,this.defaults,t.schema),null==this.viewConstructor)throw new Error("Missing viewConstructor");if(null==this.collection){if(null==this.collectionConstructor)throw new Error("Missing collection & collectionConstructor");this.collection=new this.collectionConstructor(this.model.get(this.key))}this.collection.on("add remove",this._showCollection),this.collection.toJSON=function(){return this.reset(this.where({checked:!0})),i.Collection.prototype.toJSON.apply(this,arguments)},this.collection.fetch({reset:!0})},render:function(){return this._initCollectionView(),this.$el.html(this.collectionView.$el),this._showCollection(),this},getValue:function(){return this.collection.toJSON()},setValue:function(e){if(!n(e).isArray())throw new Error("Format Error");this.collection.reset(e)},dialogReady:function(){this._showCollection()},className:"",_showCollection:function(){0==this.collection.length?this.$el.hide():this.$el.show()},_initCollectionView:function(){this.collectionView||(this.collectionView=new this.viewConstructor({collection:this.collection})),this.collectionView.render()}}),e.Form.editors.FilesUpload=e.Form.editors.BaseUploader.extend({initialize:function(){e.Form.editors.BaseUploader.prototype.initialize.apply(this,arguments),this._additionalInitialzer()},_additionalInitialzer:function(){n.extend(this.collection,{pid:this.params.pid,achievement_id:this.params.achievement_id}),(n.isUndefined(this.schema.loadDocs)||this.schema.loadDocs)&&this.collection.fetch({reset:!0})},render:function(){return a(this.dropZone).length>0&&e.Form.editors.BaseUploader.prototype.render.apply(this,arguments),this},dropZoneDragOver:"dropZoneDragOver",dropZoneReady:function(){var e=this;a(this.dropZone).on("dragover.Uploader",function(t){t.preventDefault(),a(this).addClass(e.dropZoneDragOver)}).on("dragend.Uploader",function(t){t.preventDefault(),e.collection.length>0&&a(this).removeClass(e.dropZoneDragOver)}).on("dragleave.Uploader",function(t){t.preventDefault(),e.collection.length>0&&a(this).removeClass(e.dropZoneDragOver)}).on("drop.Uploader",function(t){t.preventDefault(),e.uploader.constructor.support.dropFiles?(a(this).removeClass(e.dropZoneDragOver),t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.files&&e.uploader.addToList(t.originalEvent.dataTransfer.files)):(e.collection.length>0&&a(this).removeClass(e.dropZoneDragOver),Spms.vent.trigger("message","当前浏览器不支持文件拖拽方式上传"))}),this.render()},_initAttachesView:function(){this.attachesView||(this.attachesView=new this.viewsName({collection:this.collection}),this.attachesView.render(),this.attachesView.on("childview:removeAttach",this.removeChildAttach),this.attachesView.on("childview:hide",this._showAttaches))},removeChildAttach:function(e,t){var i=this,s=t.model;s.isNew()?i.collection.remove(s):(s.set("del_flg","1"),e.trigger("hide").$el.hide())},_showAttaches:function(){0==this.collection.where({del_flg:"0"}).length?a(this.dropZone).addClass(this.dropZoneDragOver):a(this.dropZone).removeClass(this.dropZoneDragOver)},fileAdd:function(e,t,i){var s=n.extend({uploading:!0,uniqueId:e,upload_time:Date.now()/1e3,uploader:SPMS_GV.user,del_flg:"0",name:i.name||t,size:i.size||null},n.pick(this.params,"app_type","app_id","achievement_id","pid"),{belong_unit:SPMS_GV.user.dept_ids});this.collection.add(s),this.resetButtonState(!1)},fileInvalid:function(e,t){for(var i in t.errors)Spms.vent.trigger("message",t.errors[i].message);this.resetButtonState()},className:"",uploadError:function(e){var t=this.collection.findWhere({uniqueId:e});Spms.vent.trigger("message","网络传输异常，请联系管理员！"),this.collection.remove(t),this.resetButtonState()},uploadComplete:function(e,t,i,s){var a=this.collection.findWhere({uniqueId:e});return i=JSON.parse(i),null!=s&&200!=s?(Spms.vent.trigger("message","系统异常，请联系管理员！"),this.resetButtonState(),void 0):n.isUndefined(i.error)?(a.unset("uploading",{silent:!0}).set({id:i.id,ext_name:i.ext_name,size:i.file_size}),this.resetButtonState(),void 0):(Spms.vent.trigger("message",i.error+":"+t),this.collection.remove(a),this.resetButtonState(),void 0)},setValue:function(){},resetButtonState:function(e){this.form.complete=n.isUndefined(e)?this.collection.where({uploading:!0}).length>0?!1:!0:e,this.form.setButtonState()}}),e.Form.editors.TaskFilesUpload=e.Form.editors.FilesUpload.extend({_additionalInitialzer:function(){n.extend(this.collection,{app_id:this.params.app_id,app_type:this.params.app_type,task_id:this.params.task_id,pid:this.params.pid}),(n.isUndefined(this.schema.loadDocs)||this.schema.loadDocs)&&this.collection.fetch({reset:!0})},fileAdd:function(e,t,i){var s=n.extend({uploading:!0,uniqueId:e,upload_time:Date.now()/1e3,uploader:SPMS_GV.user,del_flg:"0"},n.pick(this.params,"app_type","app_id","task_id","pid"),n.pick(i,"name","size"),{belong_unit:SPMS_GV.user.dept_ids});this.collection.add(s),this.form.complete=!1,this.form.setButtonState()}}),e.Form.editors.TextAreaHelper=e.Form.editors.TextArea.extend({defaults:{autoheight:!0},Collection:i.Collection.extend({url:"",parse:function(e){return e.data.data}}),initialize:function(e){this.options=n.extend({},this.defaults,e),this.constructor.__super__.initialize.call(this,e),this.collection=e.schema.collection||this.collection||new this.Collection,this._initAtWho(),this.options.autoheight&&this._initAutoHeight()},textChange:function(){},_initAtWho:function(){var t=a.map(e.Dicts.emojis,function(e){return{key:e,name:e}}),i=this,s={at:"@",callbacks:{remote_filter:function(e,t){i.collection.fetch({data:{s:e},reset:!0,success:function(e,i){t(i.data.data)}})},sorter:function(e,t){return t},tpl_eval:function(e,t){e="<li title=${name} data-value=${atwho-at}${name} data-id=${id} data-type=${type} data-name=${name}>${name}</li>";var i;try{return e.replace(/\$\{([^\}]*)\}/g,function(e,i){return t[i]})}catch(s){return i=s,""}},before_insert:function(e,t){return i.trigger("add_at_who",{id:t.attr("data-id"),name:t.attr("data-name"),type:t.attr("data-type")}),e}},limit:8,start_with_space:!1,startWithSpace:!1},n={at:":",data:t,tpl:"<li class='at' data-value='${atwho-at}${name}'><img src='http://assets.github.com/images/icons/emoji/${name}.png'  height='20' width='20' /></li>",insert_tpl:"<span id='${id}'>${atwho-data-value}</span>",limit:t.length};this._input_at=this.$el.atwho(s).atwho(n);var i=this;this._input_at.on("change",function(){})},_initAutoHeight:function(){this.$el.autosize()},getValue:function(){return a.trim(this.$el.val())},setValue:function(e){this.$el.val(a.trim(e))},determineChange:function(e){e&&this.options.schema.commitHelper&&13==e.keyCode&&e.ctrlKey&&this.trigger("checkSumit",e),this.trigger("change",this)}}),e.Form.editors.ShareObject=e.Form.editors.TagsInput.extend({Collection:i.Collection.extend({url:"/cmri/suggestion/share",parse:function(e){return e.data.data}}),initialize:function(t){n.extend(t);var s=t.schema.url?Ehr_HOSTS+t.schema.url:Ehr_HOSTS+"/cmri/suggestion/share";t.schema.items&&(this.defaults.items=t.schema.items),this.Collection=i.Collection.extend({url:s,parse:function(e){return e.data.data}}),e.Form.editors.TagsInput.prototype.initialize.call(this,t)},tagClass:function(e){var t="public"==e.id?"label label-success":"label label-primary";return e.locked&&(t+=" disabled"),t},onRender:function(){this.constructor.__super__.onRender.apply(this,arguments),this.$el.on("beforeItemRemove",function(e){e.item.locked&&(e.cancel=!0)})}}),e.Form.editors.ShareDepts=e.Form.editors.TagsInput.extend({defaults:{freeInput:!0,itemValue:"id",itemText:"name",items:100},Collection:t.Entities.ShareDepts,onRender:function(){var e=this;this.constructor.__super__.onRender.apply(this,arguments),this.$el.on("beforeItemRemove",function(e){e.item.locked&&(e.cancel=!0)}),a(this.$el).after('<button type="button" class="btn btn-default share-yjl-btn" aria-expanded="false">      <span class="caret"></span>      <span class="sr-only">Toggle Dropdown</span>      </button>'),a(this.$el).parent().find("button").on("click",function(){e.$el.tagsinput()[0].$input.val(" ").focus(),e.$el.tagsinput()[0].$input.trigger("keyup")})}}),e.Form.editors.ShareSpecail=e.Form.editors.TagsInput.extend({Collection:i.Collection.extend({url:"/spms/console/manager",parse:function(e){var t=[e.data.list[0].member,e.data.list[1].member];return t=n.flatten(t)}}),initialize:function(t){n.extend(t),t.schema.url&&(this.Collection.url=t.schema.url),e.Form.editors.TagsInput.prototype.initialize.call(this,t)},tagClass:function(e){var t="public"==e.id?"label label-success":"label label-primary";return e.locked&&(t+=" disabled"),t},onRender:function(){this.constructor.__super__.onRender.apply(this,arguments),this.$el.on("beforeItemRemove",function(e){e.item.locked&&(e.cancel=!0)})}}),e.Form.editors.DictCheckboxes=e.Form.editors.BootstrapCheckboxes.extend({_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.get("name")})});var i=this._arrayToHtml(t);return i},getValue:function(){var e,t=this,i=[];return this.$("input[type=checkbox]:checked").each(function(){e=n.findWhere(t._array,{val:a(this).val()}),i.push({id:e.val,name:e.label})}),i},setValue:function(e){n.isArray(e)?e=n.pluck(e,"id"):n.isArray(e)||(e=[e]),this.$("input[type=checkbox]").val(e)}}),e.Form.editors.InlineNestedModel=e.Form.editors.Object.extend({initialize:function(t){if(e.Form.editors.Base.prototype.initialize.call(this,t),!this.form)throw new Error('Missing required option "form"');if(!t.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var e=this.form.constructor,t=this.value||{},i=(this.key,this.schema.model),s=t.constructor===i?t:new i(t);return this.nestedForm=new e({model:s,idPrefix:this.id+"_",fieldTemplate:"nestedFieldInline",template:n.template('<div class="bbf-nested-form" data-fieldsets=""></div>')}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){return e.Form.prototype.commit.call(this.nestedForm)},validate:function(){return e.Form.prototype.validate.call(this.nestedForm)}}),e.Form.editors.Slider=e.Form.editors.Base.extend({initialize:function(e){if(i.Form.editors.Base.prototype.initialize.call(this,e),!this.schema||!this.schema.sliderOptions)throw new Error("Missing required 'schema.sliderOptions'");this.initSlider()},initSlider:function(){var e=this,t=this.schema.sliderOptions;this.$sliderContainer=a("<div class='slider-container well'><input name='"+this.key+"'/></div>"),this.$slider=this.$sliderContainer.find("input").slider(n.pick(t,function(e,t){return t in Slider.prototype.defaultOptions})).on("slide",function(){}).on("change",function(i){var s=i.value;return t.max_value&&s.newValue>t.max_value?(e.setValue(s.oldValue),void 0):t.min_value&&s.newValue<t.min_value?(e.$slider.setValue(s.oldValue),void 0):void 0}).data("slider")},render:function(){return this.$el.append(this.$sliderContainer),this},getValue:function(){return this.$slider.getValue()},setValue:function(e){this.$slider.setValue(e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),e.Form.editors.Files=e.Form.editors.Base.extend({tagName:"div",className:"filesEditor-container",initialize:function(){n.bindAll(this,"fileAdd","fileRemove","fileInvalid","tooManyFiles","beforeUpload","uploadStart","uploadProgress","uploadComplete","uploadFail","uploadAbort","initUploader","destroyUploader"),e.Form.editors.Base.prototype.initialize.apply(this,arguments),this.files=new i.Collection(this.model.get(this.key))},getValue:function(){return this.files.toJSON()},setValue:function(e){if(!n(e).isArray())throw new Error("文件格式错误");this.files.set(e)},validate:function(){var t=this,i={type:"uploader",message:"文件正在上传，请稍后..."};return this.uploader&&0!=n.filter(this.files.models,function(e){return e.get("uploading")}).length?(new Juggler.Notify({message:"文件正在上传，请稍后..."},{delay:1e3}),setTimeout(function(){t.clearError()},500),i):e.Form.editors.Base.prototype.validate.apply(this)},clearError:function(){var e=this.form.$el.find("."+this.schema.fieldClass);e.find("[data-error]").empty(),e.removeClass("has-error")},render:function(){return this.uploader||(this.beforeInitUploader(),this.initUploader()),this},resetButtonState:function(e){this.form.complete=n.isUndefined(e)?this.files.where({uploading:!0}).length>0?!1:!0:e,this.form.setButtonState()},destroyUploader:function(){this.uploader.destroyAll()},beforeInitUploader:function(){var e=this.schema.getFilesView(),t='<span class="btn btn-default btn-file js-btn-uploader pull-left">'+this.schema.title+"</span>";this.filesView=new e({collection:this.files}),this.$el.append(t),this.$selectButton=this.$el.find(".js-btn-uploader"),this.$el.append(this.filesView.render().$el),this.$dropZone=this.filesView.$el},initUploader:function(){var e=this,t={acceptSize:[null,51200],errors:{invalidType:"文件：{{fileName}}格式无效，只能上传如下后缀的文件: {{allowedExtensions}}",sizeTooSmall:"文件：{{fileName}}太小了，请上传大于{{allowedMinSize}}的文件。",sizeTooLarge:"文件：{{fileName}}太大了，请重新上传小于{{allowedMaxSize}}的文件。",tooManyFiles:"无法上传文件：{{fileName}}，因为你一次只能上传{{maxFiles}}文件。",networkError:"在上传文件：{{fileName}}过程中出现异常，请重新上传。"},headers:{Accept:"application/json, text/javascript, */*; q=0.01"},selectButton:this.$selectButton,dropZone:this.$dropZone,multiple:!0};this.uploader=new Uploader(n.defaults(t,e.schema.uploaderOptions)),this.uploader.on("fileAdd",this.fileAdd).on("fileRemove",this.fileRemove).on("fileInvalid",this.fileInvalid).on("tooManyFile",this.tooManyFiles).on("beforeUpload",this.beforeUpload).on("uploadStart",this.uploadStart).on("uploadProgress",this.uploadProgress).on("uploadComplete",this.uploadComplete).on("uploadFail",this.uploadFail).on("uploadAbort",this.uploadAbort)},fileAdd:function(e,t,i){var s={uploading:!0,uniqueId:e,upload_time:Date.now()/1e3,del_flg:"0",name:i.name||t,size:i.size||null};
this.files.add(s),this.resetButtonState(!1)},fileRemove:function(){},fileInvalid:function(){this.resetButtonState()},tooManyFiles:function(){},beforeUpload:function(){console.log("beforeUpload")},uploadStart:function(){console.log("uploadStart")},uploadProgress:function(){console.log("uploadProgress")},uploadComplete:function(e,t,i,s){var a=this.files.findWhere({uniqueId:e});return i=JSON.parse(i),null!=s&&200!=s?(Spms.vent.trigger("message","系统异常，请联系管理员！"),this.resetButtonState(),void 0):n.isUndefined(i.error)?(a.unset("uploading",{silent:!0}).set({id:i.id}),this.trigger("change",this),this.resetButtonState(),void 0):(Spms.vent.trigger("message",i.error+":"+t),this.files.remove(a),this.resetButtonState(),void 0)},uploadFail:function(){},uploadAbort:function(){}}),e.Pills=t.Views.List.extend({className:"nav nav-pills"}),e.FilterItem=t.Views.Item.extend({onClick:function(e){var t=a.param(this.model.toJSON());i.history.navigate(t),e.preventDefault()}}),e.Filter=e.Pills.extend({childView:e.FilterItem,emptyView:t.Views.ItemView}),e.GroupItem=t.Views.Item.extend({className:"list-group-item"}),e.ListGroup=t.Views.List.extend({className:"list-group",childView:e.GroupItem}),e.Pagination=t.Views.List.extend({className:"pagination pull-right",defaults:{first:"&laquo;",prev:"&lsaquo;",next:"&rsaquo;",last:"&raquo;",totalPages:100,startPage:1,visiblePages:10},events:{"click .disabled a":"stop"},initialize:function(e){var t=this,i=this.collection;this.defaults.onPageClick=function(e,t){i.getPage(t)},this.options=n.extend(this.defaults,e),this.collection.unbind("reset").on("reset",this.pageable,this),this.options.model.on("change",function(){t.queryParams(),t.collection.fetch({reset:!0})}),this.collection.state&&this.collection.state.totalPages&&this.pageable()},render:function(){return this},pageable:function(){this.options.totalPages=this.collection.state.totalPages||1,this.options.startPage=this.collection.state.currentPage,this.options.totalRecords=this.collection.state.totalRecords,this.onDestroy(),this.options.totalPages>1&&this.$el.twbsPagination(this.options)},queryParams:function(){this.collection.queryParams=n.extend(this.collection.queryParams,this.options.model.toJSON())},onDestroy:function(){this.$el.data("twbs-pagination")&&this.$el.twbsPagination("destroy")},stop:function(e){return e.stopPropagation(),e.preventDefault(),!1}}),e.DataList=t.Views.Layout.extend({className:"data-list",template:t.Templates.datalist,FilterView:e.Filter,ListView:e.ListGroup,PaginationView:e.Pagination,initialize:function(e){var i=new t.Entities.Collection(e.filter||[]);this.filter=new this.FilterView({collection:i}),this.list=new this.ListView({collection:this.collection}),this.pagination=new this.PaginationView({collection:this.collection,model:e.filterModel||new t.Entities.Model})},onShow:function(){this.filterRegion.show(this.filter),this.listContentRegion.show(this.list),this.paginationRegion.show(this.pagination)}}),e.Form.editors.DatePickerCheck=e.Form.editors.Text.extend({render:function(){var e=this;return i.Form.editors.Text.prototype.render.call(this),this.$el.datepicker({format:"yyyy-mm-dd",autoclose:!0,weekStart:1}).on("changeDate",function(t){var i=t.date.valueOf()/1e3;e.model.set(e.key,i)}),this},setValue:function(e){var t=new Date;e=e||t,this.$el.val(moment(e).format("YYYY-MM-DD"))}}),e.Form.editors.OpenBar=e.Form.editors.Base.extend({className:"togger",render:function(){var e=this;console.log(this.schema),this.checkbox=a('<input type="checkbox" class="togger-btn" id="togger-'+this.key+'"/>'),this.$container=a('<label for="togger-'+this.key+'"><i></i></label>'),e.$el.append(this.checkbox).append(e.$container),setTimeout(function(){console.log(e.model.get(e.key)),e.model.get(e.key)&&e.checkbox.attr({checked:"checked"}),e._init_bindEvent()},0)},_init_bindEvent:function(){var e=this;e.$container.click(function(){var t=0;e.checkbox[0].checked&&(t=1),e.value=t})},getValue:function(){return this.value},setValue:function(e){this.value=e,e?this.checkbox.attr({checked:!0}):this.checkbox.removeAttr({checked:!0})}}),e.Form.editors.Toggle=e.Form.editors.OpenBar,e.Form.editors.selectUser_commectionModel=i.Model.extend({urlRoot:"api/member"}),e.Form.editors.selectUser_commection=i.Collection.extend({url:"api/member",model:e.Form.editors.selectUser_commectionModel,parse:function(e){return e.data}}),e.Form.editors.selectUser_view=i.View.extend({className:"list-item",initialize:function(){},render:function(){return this.$el.html('<div class="list-item-w">                        <label>'+this.model.get("name")+'</label>                        <div class="checkbox-w">                          <input type="checkbox" id="'+this.model.get("id")+'-checkbox-1" name="radio-1"/>                          <label for="'+this.model.get("id")+'-checkbox-1"></label>                         </div>                      </div>'),this._init_bind(),this},_init_bind:function(){var e=this;this.checkbox=this.$el.find("input"),this.checkbox.bind("change",function(t){var i=a(t.currentTarget),s=0;i[0].checked&&(s=1),console.log(s),e.model.set({checked:s})})}}),e.Form.editors.selectUser=e.Form.editors.Base.extend({className:"select-user",initialize:function(){n.bindAll(this,"addOne","addAll"),this.collection=new e.Form.editors.selectUser_commection,this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll)},addOne:function(t){var i=new e.Form.editors.selectUser_view({model:t});this.container.append(i.render().el)},addAll:function(){this.container.html(""),this.collection.each(this.addOne)},render:function(){var e=this;this.$container=a('<div class="select-user-w">                                  <div class="select-user-add">                                    <div class="select-user-add-ico">                                     <i class="fa fa-chevron-right" aria-hidden="true"></i>                                    </div>                                    <div class="select-user-add-val">选择考勤人员</div>                                  </div>                                  <div class="select-user-c"></div>                                                                 </div>'),this._init_bindEvent(),setTimeout(function(){e.$el.append(e.$container)},0)},_init_bindEvent:function(){var e=this;this.$container.delegate(".select-user-add","click",function(){var t=document.documentElement.clientWidth||document.documentElement.clientWidth,i=(document.documentElement.clientHeight||document.documentElement.clientHeight,a('<div class="select-user-list">                              <div class="bar bar-header">                               <div class="bar-w">                                <button type="button" class="btn back">返回</button>                                <button type="button" class="btn right save">保存</button>                                <h1 class="ellipsis">选择考勤人员</h1>                               </div>                              </div>                               <div class="select-user-list-w list">                                                              </div>                              <div class="select-user-list-c list">                                <div class="list-w"></div>                              </div>                              <div class="select-user-select hide"></div>                            </div>'));i.css({left:t+"px",width:t+"px"}),a("body").append(i),i.stop().animate({left:0}),i.delegate(".back","click",function(){this.trigger("save"),i.remove()}),i.delegate(".save","click",function(){i.remove()}),e.container=i.find(".list-w"),e.collection.fetch(),e.collection.reset([{id:"1111",name:"111",checked:!1},{id:"222",name:"222",checked:!1},{id:"3333",name:"333",checked:!1}])})}}),e.Form.editors.selectWorkSystem_view=i.View.extend({className:"list-item",initialize:function(){},render:function(){return this.$el.html('<div class="list-item-w">                        <label>'+this.model.get("name")+'</label>                        <div class="radio-w">                          <input type="radio" id="'+this.model.get("id")+'-radio-1" name="radio-1"/>                          <label for="'+this.model.get("id")+'-radio-1"></label>                         </div>                      </div>'),this._init_bind(),this},_init_bind:function(){var e=this;this.checkbox=this.$el.find("input"),this.checkbox.bind("change",function(t){var i=a(t.currentTarget),s=0;i[0].checked&&(s=1),e.model.set({checked:s})})}}),e.Form.editors.selectWorkSystem_commection=i.Collection.extend({}),e.Form.editors.selectWorkSystem=e.Form.editors.Base.extend({className:"select-work",initialize:function(){n.bindAll(this,"addOne","addAll"),this.collection=new e.Form.editors.selectWorkSystem_commection,this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll)},addOne:function(t){var i=new e.Form.editors.selectWorkSystem_view({model:t});this.container.append(i.render().el)},addAll:function(){this.container.html(""),this.collection.each(this.addOne)},render:function(){var e=this;this.$container=a('<div class="select-w">                              <div class="select-worksystem-list">                              </div>                              <div class="select-user-c"></div>                            </div>'),e.container=this.$container.find(".select-worksystem-list"),e.collection.reset([{id:"1111",name:"自由班制",checked:!1},{id:"222",name:"固定班制",checked:!1},{id:"3333",name:"流水班制",checked:!1}]),this._init_bindEvent(),setTimeout(function(){e.$el.append(e.$container)},0)},_init_bindEvent:function(){}}),e.Form.editors.Date=e.Form.editors.Base.extend({className:"Form-date",render:function(){this.$el.html('<div class="Form-date-w">                        <input type="date"/>                       </div>'),this._init_bindEvent()},_init_bindEvent:function(){var e=this;this.input=this.$el.find("input");var t=this.formateData(Date.parse(new Date)/1e3);this.input.val(t),this.input.on("change",function(){e.model.set(e.key,e.getValue())})},formateData:function(e){var t=new Date(1e3*e),i=t.getFullYear(),s=t.getMonth()+1,a=t.getDate();return i+"-"+(10>s?"0"+s:s)+"-"+(10>a?"0"+a:a)},getValue:function(){var e=Date.parse(new Date(this.input))/1e3;return e},setValue:function(e){var t=this.formateData(Date.parse(new Date(e))/1e3);this.input.val(t)}}),e.Form.editors.calendarPicker=e.Form.editors.Base.extend({className:"Form-date",render:function(){this.$el.html('<div class="Form-date-w">                             <div class="date-select">                                  <input  value="" class="" readonly="readonly" name="appDate" id="appDate" type="text">                                  <i class="fa fa-chevron-down" aria-hidden="true"></i>                             </div>                           </div>'),this._init_bindEvent()},_init_bindEvent:function(){var e=this;this.input=this.$el.find("input"),this.dateSelect=this.$el.find(".date-select");var t=this.formateData(Date.parse(new Date)/1e3);this.input.val(t),this.input.on("change",function(){e.model.set(e.key,e.getValue())}),this.dateSelect.on("click",function(){console.log(123);var e=(new Date).getFullYear(),t={};t.date={preset:"date"},t.default={theme:"android-ics light",display:"modal",mode:"scroller",dateFormat:"yyyy-mm-dd",lang:"zh",showNow:!0,nowText:"今天",startYear:e-10,endYear:e+10},a("#appDate").mobiscroll(a.extend(t.date,t["default"]))})},formateData:function(e){var t=new Date(1e3*e),i=t.getFullYear(),s=t.getMonth()+1,a=t.getDate();return i+"-"+(10>s?"0"+s:s)+"-"+(10>a?"0"+a:a)},getValue:function(){var e=Date.parse(new Date(this.input))/1e3;return e},setValue:function(e){var t=this.formateData(Date.parse(new Date(e))/1e3);this.input.val(t)}}),e.Form.editors.FormSelect=e.Form.editors.Base.extend({className:"form-select",render:function(){console.log(this);var e=n.map(this.schema.list,function(e){return'<option value="'+e.key+'">'+e.val+"</option>"}).join("");this.$el.html('<select class="form-select-w">'+e+"</select>"),this._init_bindEvent()},_init_bindEvent:function(){this.select=this.$el.delegate(".form-select-w"),this.select.find("option[value="+(this.model.get(this.key)||this.schema.list[0].key)+"]").attr("selected",!0),this.select.on("change",function(){self.trigger("change")})},getValue:function(){return this.select.val()},setValue:function(e){this.select.val(e)}}),e.Form.editors.iCheckBoxCollection=i.Collection.extend({}),e.Form.editors.iCheckBox_itemview=i.View.extend({className:"list-item",initialize:function(){},render:function(){return this.$el.html('<div class="list-item-w">                        <label>'+this.model.get("name")+'</label>                        <div class="checkbox-w">                          <input type="checkbox" id="'+this.model.get("id")+'-checkbox-1" name="radio-1"/>                          <label for="'+this.model.get("id")+'-checkbox-1"></label>                         </div>                      </div>'),this._init_bind(),this},_init_bind:function(){var e=this;this.checkbox=this.$el.find("input"),this.checkbox.bind("change",function(t){var i=a(t.currentTarget),s=0;i[0].checked&&(s=1),console.log(s),e.model.set({checked:s})})}}),e.Form.editors.iCheckBox=e.Form.editors.Base.extend({className:"list-w",initialize:function(){n.bindAll(this,"addOne","addAll"),this.collection=new e.Form.editors.iCheckBoxCollection,this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll)},addOne:function(t){var i=new e.Form.editors.selectUser_view({model:t});this.container.append(i.render().el)},addAll:function(){this.container.html(""),this.collection.each(this.addOne)},render:function(){var e=this;this.$container=a('<div class="select-list">                                  <div class="select-list-w"></div>                                </div>'),e.container=this.$container.find(".select-list-w"),e.collection.reset([{id:"1111",name:"游泳",checked:!1},{id:"222",name:"摄影",checked:!1},{id:"333",name:"旅游",checked:!1},{id:"444",name:"电影",checked:!1}]),this._init_bindEvent(),setTimeout(function(){e.$el.append(e.$container)},0)},_init_bindEvent:function(){}}),e.Form.editors.iRadio_view=i.View.extend({className:"list-item",initialize:function(){},render:function(){return this.$el.html('<div class="list-item-w">                        <label>'+this.model.get("name")+'</label>                        <div class="radio-w">                          <input type="radio" id="'+this.model.get("id")+'-radio-1" name="radio-1"/>                          <label for="'+this.model.get("id")+'-radio-1"></label>                         </div>                      </div>'),this._init_bind(),this},_init_bind:function(){var e=this;this.checkbox=this.$el.find("input"),this.checkbox.bind("change",function(t){var i=a(t.currentTarget),s=0;i[0].checked&&(s=1),console.log(s),e.model.set({checked:s})})}}),e.Form.editors.iRadioCollection=i.Collection.extend({}),e.Form.editors.iRadio=e.Form.editors.Base.extend({className:"list-w",initialize:function(){n.bindAll(this,"addOne","addAll"),this.collection=new e.Form.editors.iRadioCollection,this.collection.bind("add",this.addOne),this.collection.bind("reset",this.addAll)},addOne:function(t){var i=new e.Form.editors.selectWorkSystem_view({model:t});this.container.append(i.render().el)},addAll:function(){this.container.html(""),this.collection.each(this.addOne)},render:function(){var e=this;this.$container=a('<div class="select-list">                                  <div class="select-list-w"></div>                                </div>'),e.container=this.$container.find(".select-list-w"),e.collection.reset([{id:"1111",name:"111",checked:!1},{id:"222",name:"222",checked:!1},{id:"3333",name:"333",checked:!1}]),this._init_bindEvent(),setTimeout(function(){e.$el.append(e.$container)},0)},_init_bindEvent:function(){}})}),Jma.module("Dicts",function(){}),Jma.module("Entities",function(){})(function(e,t){function i(){return new Date(Date.UTC.apply(Date,arguments))}function s(){var e=new Date;return i(e.getFullYear(),e.getMonth(),e.getDate())}function a(e){return function(){return this[e].apply(this,arguments)}}function n(t,i){function s(e,t){return t.toLowerCase()}var a,n=e(t).data(),o={},r=new RegExp("^"+i.toLowerCase()+"([A-Z])");i=new RegExp("^"+i.toLowerCase());for(var l in n)i.test(l)&&(a=l.replace(r,s),o[a]=n[l]);return o}function o(t){var i={};if(m[t]||(t=t.split("-")[0],m[t])){var s=m[t];return e.each(p,function(e,t){t in s&&(i[t]=s[t])}),i}}var r=e(window),l=function(){var t={get:function(e){return this.slice(e)[0]},contains:function(e){for(var t=e&&e.valueOf(),i=0,s=this.length;s>i;i++)if(this[i].valueOf()===t)return i;return-1},remove:function(e){this.splice(e,1)},replace:function(t){t&&(e.isArray(t)||(t=[t]),this.clear(),this.push.apply(this,t))},clear:function(){this.length=0},copy:function(){var e=new l;return e.replace(this),e}};return function(){var i=[];return i.push.apply(i,arguments),e.extend(i,t),i}}(),c=function(t,i){this.dates=new l,this.viewDate=s(),this.focusDate=null,this._process_options(i),this.element=e(t),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=e(f.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today, tfoot th.clear").attr("colspan",function(e,t){return parseInt(t)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};c.prototype={constructor:c,_process_options:function(t){this._o=e.extend({},this._o,t);var i=this.o=e.extend({},this._o),s=i.language;switch(m[s]||(s=s.split("-")[0],m[s]||(s=u.language)),i.language=s,i.startView){case 2:case"decade":i.startView=2;break;case 1:case"year":i.startView=1;break;default:i.startView=0}switch(i.minViewMode){case 1:case"months":i.minViewMode=1;break;case 2:case"years":i.minViewMode=2;break;default:i.minViewMode=0}i.startView=Math.max(i.startView,i.minViewMode),i.multidate!==!0&&(i.multidate=Number(i.multidate)||!1,i.multidate=i.multidate!==!1?Math.max(0,i.multidate):1),i.multidateSeparator=String(i.multidateSeparator),i.weekStart%=7,i.weekEnd=(i.weekStart+6)%7;var a=f.parseFormat(i.format);i.startDate!==-1/0&&(i.startDate=i.startDate?i.startDate instanceof Date?this._local_to_utc(this._zero_time(i.startDate)):f.parseDate(i.startDate,a,i.language):-1/0),1/0!==i.endDate&&(i.endDate=i.endDate?i.endDate instanceof Date?this._local_to_utc(this._zero_time(i.endDate)):f.parseDate(i.endDate,a,i.language):1/0),i.daysOfWeekDisabled=i.daysOfWeekDisabled||[],e.isArray(i.daysOfWeekDisabled)||(i.daysOfWeekDisabled=i.daysOfWeekDisabled.split(/[,\s]*/)),i.daysOfWeekDisabled=e.map(i.daysOfWeekDisabled,function(e){return parseInt(e,10)});var n=String(i.orientation).toLowerCase().split(/\s+/g),o=i.orientation.toLowerCase();if(n=e.grep(n,function(e){return/^auto|left|right|top|bottom$/.test(e)}),i.orientation={x:"auto",y:"auto"},o&&"auto"!==o)if(1===n.length)switch(n[0]){case"top":case"bottom":i.orientation.y=n[0];break;case"left":case"right":i.orientation.x=n[0]}else o=e.grep(n,function(e){return/^left|right$/.test(e)}),i.orientation.x=o[0]||"auto",o=e.grep(n,function(e){return/^top|bottom$/.test(e)}),i.orientation.y=o[0]||"auto";else;},_events:[],_secondaryEvents:[],_applyEvents:function(e){for(var i,s,a,n=0;n<e.length;n++)i=e[n][0],2===e[n].length?(s=t,a=e[n][1]):3===e[n].length&&(s=e[n][1],a=e[n][2]),i.on(a,s)},_unapplyEvents:function(e){for(var i,s,a,n=0;n<e.length;n++)i=e[n][0],2===e[n].length?(a=t,s=e[n][1]):3===e[n].length&&(a=e[n][1],s=e[n][2]),i.off(s,a)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:e.proxy(this.show,this),keyup:e.proxy(function(t){-1===e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:e.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:e.proxy(this.show,this),keyup:e.proxy(function(t){-1===e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:e.proxy(this.keydown,this)}],[this.component,{click:e.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:e.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:e.proxy(function(e){this._focused_from=e.target},this)}],[this.element,{blur:e.proxy(function(e){this._focused_from=e.target},this)}]),this._secondaryEvents=[[this.picker,{click:e.proxy(this.click,this)}],[e(window),{resize:e.proxy(this.place,this)}],[e(document),{"mousedown touchstart":e.proxy(function(e){this.element.is(e.target)||this.element.find(e.target).length||this.picker.is(e.target)||this.picker.find(e.target).length||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(t,i){var s=i||this.dates.get(-1),a=this._utc_to_local(s);this.element.trigger({type:t,date:a,dates:e.map(this.dates,this._utc_to_local),format:e.proxy(function(e,t){0===arguments.length?(e=this.dates.length-1,t=this.o.format):"string"==typeof e&&(t=e,e=this.dates.length-1),t=t||this.o.format;var i=this.dates.get(e);return f.formatDate(i,t,this.o.language)},this)})},show:function(){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.place(),this._attachSecondaryEvents(),this._trigger("show")},hide:function(){this.isInline||this.picker.is(":visible")&&(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},_utc_to_local:function(e){return e&&new Date(e.getTime()+6e4*e.getTimezoneOffset())},_local_to_utc:function(e){return e&&new Date(e.getTime()-6e4*e.getTimezoneOffset())},_zero_time:function(e){return e&&new Date(e.getFullYear(),e.getMonth(),e.getDate())},_zero_utc_time:function(e){return e&&new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))},getDates:function(){return e.map(this.dates,this._utc_to_local)},getUTCDates:function(){return e.map(this.dates,function(e){return new Date(e)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){return new Date(this.dates.get(-1))},setDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,t),this._trigger("changeDate"),this.setValue()},setUTCDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,e.map(t,this._utc_to_local)),this._trigger("changeDate"),this.setValue()},setDate:a("setDates"),setUTCDate:a("setUTCDates"),setValue:function(){var e=this.getFormattedDate();if(this.isInput){var t=this.o.language;f.formatDate(this.dates[0],"yyyy",t)==f.formatDate(new Date(1970,1,1,0,0,0),"yyyy",t)&&(e=""),this.element.val(e).change()}else this.component&&this.element.find("input").val(e).change()},getFormattedDate:function(i){i===t&&(i=this.o.format);var s=this.o.language;return e.map(this.dates,function(e){return f.formatDate(e,i,s)}).join(this.o.multidateSeparator)},setStartDate:function(e){this._process_options({startDate:e}),this.update(),this.updateNavArrows()},setEndDate:function(e){this._process_options({endDate:e}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(e){this._process_options({daysOfWeekDisabled:e}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var t=this.picker.outerWidth(),i=this.picker.outerHeight(),s=10,a=r.width(),n=r.height(),o=r.scrollTop(),l=[];this.element.parents().each(function(){var t=e(this).css("z-index");"auto"!==t&&0!==t&&l.push(parseInt(t))});var c=Math.max.apply(Math,l)+10,d=this.component?this.component.parent().offset():this.element.offset(),h=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),u=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),p=d.left,m=d.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(p-=t-u)):(this.picker.addClass("datepicker-orient-left"),d.left<0?p-=d.left-s:d.left+t>a&&(p=a-t-s));var f,g,v=this.o.orientation.y;"auto"===v&&(f=-o+d.top-i,g=o+n-(d.top+h+i),v=Math.max(f,g)===g?"top":"bottom"),this.picker.addClass("datepicker-orient-"+v),"top"===v?m+=h:m-=i+parseInt(this.picker.css("padding-top")),this.picker.css({top:m,left:p,zIndex:c})}},_allow_update:!0,update:function(){if(this._allow_update){var t=this.dates.copy(),i=[],s=!1;arguments.length?(e.each(arguments,e.proxy(function(e,t){t instanceof Date&&(t=this._local_to_utc(t)),i.push(t)},this)),s=!0):(i=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),i=i&&this.o.multidate?i.split(this.o.multidateSeparator):[i],delete this.element.data().date),i=e.map(i,e.proxy(function(e){return f.parseDate(e,this.o.format,this.o.language)},this)),i=e.grep(i,e.proxy(function(e){return e<this.o.startDate||e>this.o.endDate||!e},this),!0),this.dates.replace(i),this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate&&(this.viewDate=new Date(this.o.endDate)),s?this.setValue():i.length&&String(t)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&t.length&&this._trigger("clearDate"),this.fill()}},fillDow:function(){var e=this.o.weekStart,t="<tr>";if(this.o.calendarWeeks){var i='<th class="cw">&nbsp;</th>';t+=i,this.picker.find(".datepicker-days thead tr:first-child").prepend(i)}for(;e<this.o.weekStart+7;)t+='<th class="dow">'+m[this.o.language].daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datepicker-days thead").append(t)},fillMonths:function(){for(var e="",t=0;12>t;)e+='<span class="month">'+m[this.o.language].monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").html(e)},setRange:function(t){t&&t.length?this.range=e.map(t,function(e){return e.valueOf()}):delete this.range,this.fill()},getClassNames:function(t){var i=[],s=this.viewDate.getUTCFullYear(),a=this.viewDate.getUTCMonth(),n=new Date;return t.getUTCFullYear()<s||t.getUTCFullYear()===s&&t.getUTCMonth()<a?i.push("old"):(t.getUTCFullYear()>s||t.getUTCFullYear()===s&&t.getUTCMonth()>a)&&i.push("new"),this.focusDate&&t.valueOf()===this.focusDate.valueOf()&&i.push("focused"),this.o.todayHighlight&&t.getUTCFullYear()===n.getFullYear()&&t.getUTCMonth()===n.getMonth()&&t.getUTCDate()===n.getDate()&&i.push("today"),-1!==this.dates.contains(t)&&i.push("active"),(t.valueOf()<this.o.startDate||t.valueOf()>this.o.endDate||-1!==e.inArray(t.getUTCDay(),this.o.daysOfWeekDisabled))&&i.push("disabled"),this.range&&(t>this.range[0]&&t<this.range[this.range.length-1]&&i.push("range"),-1!==e.inArray(t.valueOf(),this.range)&&i.push("selected")),i},fill:function(){this.viewDate.getTime()<864e5&&(this.viewDate=new Date);var s,a=new Date(this.viewDate),n=a.getUTCFullYear(),o=a.getUTCMonth(),r=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,l=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,c=1/0!==this.o.endDate?this.o.endDate.getUTCFullYear():1/0,d=1/0!==this.o.endDate?this.o.endDate.getUTCMonth():1/0,h=m[this.o.language].today||m.en.today||"",u=m[this.o.language].clear||m.en.clear||"";if(!isNaN(n)&&!isNaN(o)){this.picker.find(".datepicker-days thead th.datepicker-switch").text(m[this.o.language].months[o]+" "+n),this.picker.find("tfoot th.today").text(h).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot th.clear").text(u).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var p=i(n,o-1,28),g=f.getDaysInMonth(p.getUTCFullYear(),p.getUTCMonth());p.setUTCDate(g),p.setUTCDate(g-(p.getUTCDay()-this.o.weekStart+7)%7);var v=new Date(p);v.setUTCDate(v.getUTCDate()+42),v=v.valueOf();for(var b,y=[];p.valueOf()<v;){if(p.getUTCDay()===this.o.weekStart&&(y.push("<tr>"),this.o.calendarWeeks)){var w=new Date(+p+(this.o.weekStart-p.getUTCDay()-7)%7*864e5),k=new Date(Number(w)+(11-w.getUTCDay())%7*864e5),_=new Date(Number(_=i(k.getUTCFullYear(),0,1))+(11-_.getUTCDay())%7*864e5),D=(k-_)/864e5/7+1;y.push('<td class="cw">'+D+"</td>")}if(b=this.getClassNames(p),b.push("day"),this.o.beforeShowDay!==e.noop){var C=this.o.beforeShowDay(this._utc_to_local(p));C===t?C={}:"boolean"==typeof C?C={enabled:C}:"string"==typeof C&&(C={classes:C}),C.enabled===!1&&b.push("disabled"),C.classes&&(b=b.concat(C.classes.split(/\s+/))),C.tooltip&&(s=C.tooltip)}b=e.unique(b),y.push('<td class="'+b.join(" ")+'"'+(s?' title="'+s+'"':"")+">"+p.getUTCDate()+"</td>"),s=null,p.getUTCDay()===this.o.weekEnd&&y.push("</tr>"),p.setUTCDate(p.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(y.join(""));var x=this.picker.find(".datepicker-months").find("th:eq(1)").text(n).end().find("span").removeClass("active");e.each(this.dates,function(e,t){t.getUTCFullYear()===n&&x.eq(t.getUTCMonth()).addClass("active")}),(r>n||n>c)&&x.addClass("disabled"),n===r&&x.slice(0,l).addClass("disabled"),n===c&&x.slice(d+1).addClass("disabled"),y="",n=10*parseInt(n/10,10);var T=this.picker.find(".datepicker-years").find("th:eq(1)").text(n+"-"+(n+9)).end().find("td");n-=1;for(var F,S=e.map(this.dates,function(e){return e.getUTCFullYear()}),V=-1;11>V;V++)F=["year"],-1===V?F.push("old"):10===V&&F.push("new"),-1!==e.inArray(n,S)&&F.push("active"),(r>n||n>c)&&F.push("disabled"),y+='<span class="'+F.join(" ")+'">'+n+"</span>",n+=1;T.html(y)}},updateNavArrows:function(){if(this._allow_update){var e=new Date(this.viewDate),t=e.getUTCFullYear(),i=e.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-1/0&&t<=this.o.startDate.getUTCFullYear()&&i<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&t>=this.o.endDate.getUTCFullYear()&&i>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-1/0&&t<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&t>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}}},click:function(t){t.preventDefault();var s,a,n,o=e(t.target).closest("span, td, th");if(1===o.length)switch(o[0].nodeName.toLowerCase()){case"th":switch(o[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var r=f.modes[this.viewMode].navStep*("prev"===o[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,r),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,r),1===this.viewMode&&this._trigger("changeYear",this.viewDate)
}this.fill();break;case"today":var l=new Date;l=i(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),this.showMode(-2);var c="linked"===this.o.todayBtn?null:"view";this._setDate(l,c);break;case"clear":var d;this.isInput?d=this.element:this.component&&(d=this.element.find("input")),d&&d.val("").change(),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()}break;case"span":o.is(".disabled")||(this.viewDate.setUTCDate(1),o.is(".month")?(n=1,a=o.parent().find("span").index(o),s=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(a),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(i(s,a,n))):(n=1,a=0,s=parseInt(o.text(),10)||0,this.viewDate.setUTCFullYear(s),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(i(s,a,n))),this.showMode(-1),this.fill());break;case"td":o.is(".day")&&!o.is(".disabled")&&(n=parseInt(o.text(),10)||1,s=this.viewDate.getUTCFullYear(),a=this.viewDate.getUTCMonth(),o.is(".old")?0===a?(a=11,s-=1):a-=1:o.is(".new")&&(11===a?(a=0,s+=1):a+=1),this._setDate(i(s,a,n)))}this.picker.is(":visible")&&this._focused_from&&e(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(e){var t=this.dates.contains(e);if(e||this.dates.clear(),1===this.o.multidate&&0===t||(-1!==t?this.dates.remove(t):this.dates.push(e)),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(e,t){t&&"date"!==t||this._toggle_multidate(e&&new Date(e)),t&&"view"!==t||(this.viewDate=e&&new Date(e)),this.fill(),this.setValue(),this._trigger("changeDate");var i;this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&i.change(),!this.o.autoclose||t&&"date"!==t||this.hide()},moveMonth:function(e,i){if(!e)return t;if(!i)return e;var s,a,n=new Date(e.valueOf()),o=n.getUTCDate(),r=n.getUTCMonth(),l=Math.abs(i);if(i=i>0?1:-1,1===l)a=-1===i?function(){return n.getUTCMonth()===r}:function(){return n.getUTCMonth()!==s},s=r+i,n.setUTCMonth(s),(0>s||s>11)&&(s=(s+12)%12);else{for(var c=0;l>c;c++)n=this.moveMonth(n,i);s=n.getUTCMonth(),n.setUTCDate(o),a=function(){return s!==n.getUTCMonth()}}for(;a();)n.setUTCDate(--o),n.setUTCMonth(s);return n},moveYear:function(e,t){return this.moveMonth(e,12*t)},dateWithinRange:function(e){return e>=this.o.startDate&&e<=this.o.endDate},keydown:function(e){if(this.picker.is(":not(:visible)"))return 27===e.keyCode&&this.show(),void 0;var t,i,a,n=!1,o=this.focusDate||this.viewDate;switch(e.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),e.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;t=37===e.keyCode?-1:1,e.ctrlKey?(i=this.moveYear(this.dates.get(-1)||s(),t),a=this.moveYear(o,t),this._trigger("changeYear",this.viewDate)):e.shiftKey?(i=this.moveMonth(this.dates.get(-1)||s(),t),a=this.moveMonth(o,t),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||s()),i.setUTCDate(i.getUTCDate()+t),a=new Date(o),a.setUTCDate(o.getUTCDate()+t)),this.dateWithinRange(i)&&(this.focusDate=this.viewDate=a,this.setValue(),this.fill(),e.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;t=38===e.keyCode?-1:1,e.ctrlKey?(i=this.moveYear(this.dates.get(-1)||s(),t),a=this.moveYear(o,t),this._trigger("changeYear",this.viewDate)):e.shiftKey?(i=this.moveMonth(this.dates.get(-1)||s(),t),a=this.moveMonth(o,t),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||s()),i.setUTCDate(i.getUTCDate()+7*t),a=new Date(o),a.setUTCDate(o.getUTCDate()+7*t)),this.dateWithinRange(i)&&(this.focusDate=this.viewDate=a,this.setValue(),this.fill(),e.preventDefault());break;case 32:break;case 13:o=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(o),n=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(e.preventDefault(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(n){this.dates.length?this._trigger("changeDate"):this._trigger("clearDate");var r;this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r&&r.change()}},showMode:function(e){e&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+e))),this.picker.find(">div").hide().filter(".datepicker-"+f.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var d=function(t,i){this.element=e(t),this.inputs=e.map(i.inputs,function(e){return e.jquery?e[0]:e}),delete i.inputs,e(this.inputs).datepicker(i).bind("changeDate",e.proxy(this.dateUpdated,this)),this.pickers=e.map(this.inputs,function(t){return e(t).data("datepicker")}),this.updateDates()};d.prototype={updateDates:function(){this.dates=e.map(this.pickers,function(e){return e.getUTCDate()}),this.updateRanges()},updateRanges:function(){var t=e.map(this.dates,function(e){return e.valueOf()});e.each(this.pickers,function(e,i){i.setRange(t)})},dateUpdated:function(t){if(!this.updating){this.updating=!0;var i=e(t.target).data("datepicker"),s=i.getUTCDate(),a=e.inArray(t.target,this.inputs),n=this.inputs.length;if(-1!==a){if(e.each(this.pickers,function(e,t){t.getUTCDate()||t.setUTCDate(s)}),s<this.dates[a])for(;a>=0&&s<this.dates[a];)this.pickers[a--].setUTCDate(s);else if(s>this.dates[a])for(;n>a&&s>this.dates[a];)this.pickers[a++].setUTCDate(s);this.updateDates(),delete this.updating}}},remove:function(){e.map(this.pickers,function(e){e.remove()}),delete this.element.data().datepicker}};var h=e.fn.datepicker;e.fn.datepicker=function(i){var s=Array.apply(null,arguments);s.shift();var a;return this.each(function(){var r=e(this),l=r.data("datepicker"),h="object"==typeof i&&i;if(!l){var p=n(this,"date"),m=e.extend({},u,p,h),f=o(m.language),g=e.extend({},u,f,p,h);if(r.is(".input-daterange")||g.inputs){var v={inputs:g.inputs||r.find("input").toArray()};r.data("datepicker",l=new d(this,e.extend(g,v)))}else r.data("datepicker",l=new c(this,g))}return"string"==typeof i&&"function"==typeof l[i]&&(a=l[i].apply(l,s),a!==t)?!1:void 0}),a!==t?a:this};var u=e.fn.datepicker.defaults={autoclose:!1,beforeShowDay:e.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},p=e.fn.datepicker.locale_opts=["format","rtl","weekStart"];e.fn.datepicker.Constructor=c;var m=e.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},f={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,t){return[31,f.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(e){var t=e.replace(this.validParts,"\x00").split("\x00"),i=e.match(this.validParts);if(!t||!t.length||!i||0===i.length)throw new Error("Invalid date format.");return{separators:t,parts:i}},parseDate:function(s,a,n){function o(){var e=this.slice(0,u[d].length),t=u[d].slice(0,e.length);return e===t}if(!s)return t;if(s instanceof Date)return s;"string"==typeof a&&(a=f.parseFormat(a));var r,l,d,h=/([\-+]\d+)([dmwy])/,u=s.match(/([\-+]\d+)([dmwy])/g);if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(s)){for(s=new Date,d=0;d<u.length;d++)switch(r=h.exec(u[d]),l=parseInt(r[1]),r[2]){case"d":s.setUTCDate(s.getUTCDate()+l);break;case"m":s=c.prototype.moveMonth.call(c.prototype,s,l);break;case"w":s.setUTCDate(s.getUTCDate()+7*l);break;case"y":s=c.prototype.moveYear.call(c.prototype,s,l)}return i(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),0,0,0)}u=s&&s.match(this.nonpunctuation)||[],s=new Date;var p,g,v={},b=["yyyy","yy","M","MM","m","mm","d","dd"],y={yyyy:function(e,t){return e.setUTCFullYear(t)},yy:function(e,t){return e.setUTCFullYear(2e3+t)},m:function(e,t){if(isNaN(e))return e;for(t-=1;0>t;)t+=12;for(t%=12,e.setUTCMonth(t);e.getUTCMonth()!==t;)e.setUTCDate(e.getUTCDate()-1);return e},d:function(e,t){return e.setUTCDate(t)}};y.M=y.MM=y.mm=y.m,y.dd=y.d,s=i(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0);var w=a.parts.slice();if(u.length!==w.length&&(w=e(w).filter(function(t,i){return-1!==e.inArray(i,b)}).toArray()),u.length===w.length){var k;for(d=0,k=w.length;k>d;d++){if(p=parseInt(u[d],10),r=w[d],isNaN(p))switch(r){case"MM":g=e(m[n].months).filter(o),p=e.inArray(g[0],m[n].months)+1;break;case"M":g=e(m[n].monthsShort).filter(o),p=e.inArray(g[0],m[n].monthsShort)+1}v[r]=p}var _,D;for(d=0;d<b.length;d++)D=b[d],D in v&&!isNaN(v[D])&&(_=new Date(s),y[D](_,v[D]),isNaN(_)||(s=_))}return s},formatDate:function(t,i,s){if(!t)return"";"string"==typeof i&&(i=f.parseFormat(i));var a={d:t.getUTCDate(),D:m[s].daysShort[t.getUTCDay()],DD:m[s].days[t.getUTCDay()],m:t.getUTCMonth()+1,M:m[s].monthsShort[t.getUTCMonth()],MM:m[s].months[t.getUTCMonth()],yy:t.getUTCFullYear().toString().substring(2),yyyy:t.getUTCFullYear()};a.dd=(a.d<10?"0":"")+a.d,a.mm=(a.m<10?"0":"")+a.m,t=[];for(var n=e.extend([],i.separators),o=0,r=i.parts.length;r>=o;o++)n.length&&t.push(n.shift()),t.push(a[i.parts[o]]);return t.join("")},headTemplate:'<thead><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};f.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+f.headTemplate+"<tbody></tbody>"+f.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+f.headTemplate+f.contTemplate+f.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+f.headTemplate+f.contTemplate+f.footTemplate+"</table></div></div>",e.fn.datepicker.DPGlobal=f,e.fn.datepicker.noConflict=function(){return e.fn.datepicker=h,this},e(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(t){var i=e(this);i.data("datepicker")||(t.preventDefault(),i.datepicker("show"))}),e(function(){e('[data-provide="datepicker-inline"]').datepicker()})}(window.jQuery)),Jma.module("Funcs",function(e,t){t.fixedNum=function(e,t){0>t&&(t=0);var i=Math.round(parseFloat(e)*Math.pow(10,t+1)/10)/Math.pow(10,t),s=i.toString().split(".")[1]?i.toString().split(".")[1].length:0;if(isNaN(i))return"0.00";0==s&&0!==t&&(i+=".");for(var a=s;t>a;a++)i=i.toString()+"0";return i+""},t.getDate=function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,s=e.getDate(),a=e.getDay(),n=t+"-"+i+"-"+s;return{date:{riqi:n,weekday:"星期"+a}}},t.getWeekDay=function(e){var t=new Date(e),i="";switch(t.getDay()){case 1:i="星期一";break;case 2:i="星期二";break;case 3:i="星期三";break;case 4:i="星期四";break;case 5:i="星期五";break;case 6:i="星期六";break;case 7:i="星期日"}return i}}),function(e,t){if("function"==typeof define&&define.amd)define(["marionette","backbone","underscore"],function(i,s,a){return e.Jma=t(e,i,s,a)});else if("undefined"!=typeof exports){var i=require("marionette"),s=require("backbone"),a=require("underscore");module.exports=t(e,i,s,a)}else e.Jma=t(e,e.Marionette,e.Backbone,e._)}(this,function(e,t,i){"use strict";var s=new t.Application;return s.VERSION="0.0.0",s.addInitializer(function(){s.addRegions({navRegion:"#nav",headerRegion:"#header",mainRegion:"#main",footerRegion:"#footer"})}),s.AppRouter=t.AppRouter.extend({onRoute:function(e,t,i){var a={name:e,path:t,args:i};s.commands.execute("change:Router",a)}}),s.on("start",function(){i.history&&i.history.start()}),s}),function(e,t){if("undefined"!=typeof module&&"object"==typeof exports){var i=require("underscore"),s=require("jQuery");module.exports=t(e,s,i)}else"function"==typeof define&&(define.amd||define.cmd)?define(["underscore","jQuery"],function(i){return e.jw=t(e,s,i)}):e.jw=t(e,e.jQuery,e._)}(this,function(e,t,i){function s(t,i,s){e.JoywokMobileApp?JoywokMobileApp.callHandler(t,o(i),function(e){d.callback(t,e,s)}):n(t,s)}function a(e,t,i){"string"==typeof t&&(t=JSON.parse(t));var s,a,n;switch(delete t.err_code,delete t.err_desc,delete t.err_detail,s=t.errMsg,i=i||{},i._complete&&(i._complete(t),delete i._complete),s=t.errMsg||"",d.config.debug&&!i.isInnerInvoke&&alert(JSON.stringify(t)),a=s.indexOf(":"),n=s.substring(a+1)){case"ok":i.success&&i.success(t);break;case"cancel":i.cancel&&i.cancel(t);break;default:i.fail&&i.fail(t)}i.complete&&i.complete(t)}function n(e,t){if(console.log("innerInvoke",e,t,d.config),!(!d.config.debug||t&&t.isInnerInvoke)){var i=l[e];i&&(e=i),t&&t._complete&&delete t._complete,console.log('"'+e+'",',t||"")}}function o(e){return e=e||{},e.appId=c.appid,e.verifyAppId=c.appid,e.verifySignType="sha1",e.verifyTimestamp=c.timestamp+"",e.verifyNonceStr=c.nonceStr,e.verifySignature=c.signature,e}var r,l,c=defaultParams={debug:!1,appid:"",timestamp:0,nonceStr:"",signature:"",jsApiList:[]};r={config:"config",setTitle:"setTitle",onMenuShareTimeline:"menu:share:timeline",onMenuShareWechat:"menu:share:wechat"},l=function(){var e,t={};for(e in r)t[r[e]]=e;return t}();var d=d||{callback:a,connectJoywokMobileApp:function(e){window.JoywokMobileApp?e(JoywokMobileApp):document.addEventListener("JoywokMobileAppReady",function(){e(JoywokMobileApp)},!1)},config:function(e){c=d.configs=i.extend(defaultParams,e),d.connectJoywokMobileApp(function(e){e.init(function(e,t){var i={"Javascript Responds":"测试中文!"};t(i)}),e.registerHandler("onFilter",function(){alert("onFilter")}),e.registerHandler("onSelectTab",function(e){"function"==typeof onJwSelectTab&&onJwSelectTab(e)}),e.registerHandler("onShowAppMore",function(){alert("onShowAppMore")}),e.registerHandler("onNavBtnClick",function(e){"function"==typeof onJwNavBtnClick&&onJwNavBtnClick(e)})})},setTitle:function(e){var t={title:e.title};s("setTitle",t,e)},checkJsApi:function(e){s("checkJsApi",{jsApiList:e.jsApiList},e)},getInfo:function(e){s("getInfo",{},e)},pushWebView:function(e){var t={url:e};s("pushWebView",t,e)},newWebView:function(e){var t={url:e};s("newWebView",t,e)},closeWebView:function(e){s("closeWebView",{},e)},setFuncBtns:function(e){var t={buttons:e};s("setFuncBtns",t,e)},setFuncBtnStatus:function(e){var t=e;s("setFuncBtnStatus",t,e)},showTabs:function(e){var t={tabs:e.tabs,selector:e.selector,style:e.style,style:e.style};s("showTabs",t,e)},hideTabs:function(e){s("hideTabs",{},e)},mailto:function(e){var t={email:e.email};s("mailto",t,e)},back:function(e){s("back",{},e)},onSelectTab:function(){"function"==typeof window.onJwSelectTab&&window.onJwSelectTab(data)},onNavBtnClick:function(e){"function"==typeof window.onJwNavBtnClick&&window.onJwNavBtnClick(e)}};return d}),Jma.module("Router",function(e,t,i,s){e.Router=t.AppRouter.extend({appRoutes:{"":"index",regist:"index"}}),e.Controller=s.Controller.extend({index:function(){i.history.navigate("#regist"),t.Regist.StartApp()},post:function(){console.log(123),t.Post.StartApp()}}),e.on("start",function(){new e.Router({controller:new e.Controller})})}),$(function(){Jma.start()}),Jma.module("Templates",function(e,t,i,s,a,n){e.Form_Field_template_0_12=n.template('    <div class="form-group field-<%= key %>">      <div class="col-sm-12 project-form-value">      <span data-editor></span>      <p class="help-block" data-error></p>      <p class="help-block"><%= help %></p>      </div>    </div>  '),e.datalist=n.template('    <div data-region="filter"></div>    <div data-region="list-content"></div>    <div data-region="pagination"></div>  '),e.emptyTemplate=n.template('    <div class="loading"><img src="/public/images/new_osn/loading.gif"/> loading</div>  '),e.Form_Field_template_3_9_nomax_tips=n.template('      <div class="form-group field-<%= key %>">        <label class="col-xs-3 control-label" for="<%= editorId %>"><%= description %> <%= title %></label>        <div class="col-xs-9">        <span data-editor></span>        </div>      </div>    ')}),Jma.module("Views",function(e,t,i,s,a,n){e.Layout=s.LayoutView.extend({template:"demo",render:function(){var e=this;return this.resolveUIRegions(),s.LayoutView.prototype.render.apply(this,arguments),this.$("[data-region]").each(function(t,i){var s=a(i).attr("data-region"),n=a.camelCase(s);n&&e.addRegion(n+"Region",{el:a(i)})}),this},resolveUIRegions:function(){if(this.ui)for(var e in this.ui)this.addRegion(e+"Region",this.ui[e])},resolveTemplateRegions:function(){var e=this,t=this.regionAttr,i="["+t+"]";this.$el.find(i).each(function(i,s){var n=a(s).attr(t);n&&e.addRegion(a.camelCase(n)+"Region","["+t+"="+n+"]")}),this.triggerMethod("resoveregion")},serializeData:function(){var e=s.LayoutView.prototype.serializeData.apply(this,arguments);return n.size(e)&&e||this.options}}),e.ItemView=s.ItemView.extend({constructor:function(e){this.options=n.defaults(e,n.result(this.defaults)),s.ItemView.prototype.constructor.apply(this,arguments)},template:n.template("")}),e.CompositeView=s.CompositeView.extend({emptyView:e.EmptyView,childViewContainer:"",template:n.template(""),getChildView:function(t){return e[t.get("viewType")]||s.getOption(this,"childView")||this.constructor}}),e.Item=e.ItemView.extend({tagName:"li",template:n.template('<a href="#<%- value %>"><%= name %></a>'),ui:{links:"a",buttons:".btn",editClass:".js-edit",deleteClass:".js-delete"},events:{"click @ui.links":"onClick","click @ui.buttons":"onPress"},triggers:{"click @ui.editClass":"edit","click @ui.deleteClass":"delete"},onClick:function(){this.trigger("clicked",this.model)},onPress:function(){this.trigger("pressed",this.model)}}),e.List=e.CompositeView.extend({tagName:"ul",template:n.template(""),childView:e.Item}),e.EmptyView=s.ItemView.extend({template:t.Templates.emptyTemplate})}),$.notifyDefaults({type:"warning",placement:{align:"center"},mouse_over:"pause",z_index:9999,template:'<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss"><span aria-hidden="true" class="fa fa-remove"></span><span class="sr-only">Close</span></button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'}),Jma.Notify=$.notify,Jma.Dialog={},Jma.Dialog.alert=function(e){$(".custom-alert").remove();var t=document.documentElement.clientHeight||document.body.clientHeight,i=$('<div class="custom-alert '+(e.buttons.length>1?"custom-confirm":"")+'">						<div class="custom-alert-bg"></div>						<div class="custom-alert-w visiHide">							'+(e.hasClose?'<div class="custom-alert-close">								<i class="fa fa-close"></i>							</div>':"")+'							<div class="custom-alert-c">								'+e.content+'							</div>							<div class="custom-alert-btn">							  '+_.map(e.buttons,function(e){return'<button type="button" class="btn btn1 '+e.cssClass+'">'+e.label+"</button>"}).join("")+"							</div>						</div>					</div>"),s=i.find(".custom-alert-w"),a=i.find(".custom-alert-btn");$("body").append(i),setTimeout(function(){console.log(s.height(),t,a.height()),s.height()>t-a.height()?(s.find(".custom-alert-c").css({maxHeight:t-30-30+"px",overflowY:"auto"}),s.css({top:0,bottom:0}).removeClass("visiHide")):s.css({marginTop:"-"+s.height()/2+"px"}).removeClass("visiHide")},0),i.delegate(".custom-alert-close","click",function(){i.remove()}),_.each(e.buttons,function(e){i.delegate("."+e.cssClass,"click",function(){e.action&&(i.remove(),e.action())})})},Jma.Dialog.confirm=Jma.Dialog.alert,Jma.Loading={},Jma.Loading.template={1:'<div class="loading-1"></div>',2:'<div class="loading-2">      <div class="loading-2-bounce1"></div>      <div class="loading-2-bounce2"></div>     </div>',3:'<div class="loading-3">      <div class="rect1"></div>      <div class="rect2"></div>      <div class="rect3"></div>      <div class="rect4"></div>      <div class="rect5"></div>     </div>',4:'<div class="loading-4">      <div class="bounce1"></div>      <div class="bounce2"></div>      <div class="bounce3"></div>     </div>',5:'<div class="loading-5">      <div class="sk-circle1 sk-circle"></div>      <div class="sk-circle2 sk-circle"></div>      <div class="sk-circle3 sk-circle"></div>      <div class="sk-circle4 sk-circle"></div>      <div class="sk-circle5 sk-circle"></div>      <div class="sk-circle6 sk-circle"></div>      <div class="sk-circle7 sk-circle"></div>      <div class="sk-circle8 sk-circle"></div>      <div class="sk-circle9 sk-circle"></div>      <div class="sk-circle10 sk-circle"></div>      <div class="sk-circle11 sk-circle"></div>      <div class="sk-circle12 sk-circle"></div>     </div>'},Jma.Loading.main=Backbone.View.extend({initialize:function(e){_.extend(this,e),this.$el=$('<div class="loading-specail">                    <div class="loading-specail-w"></div>                   </div>'),this._init_render(),this._init_value(),this.specailClassName&&this.$el.addClass(this.specailClassName),this.region&&this.region.append(this.$el)},_init_render:function(){this.$el.find(".loading-specail-w").append(Jma.Loading.template[this.type])},_init_value:function(){this.value&&this.$el.append('<div class="loading-specail-value">'+this.value+"</div>")},close:function(){this.$el.remove()}});